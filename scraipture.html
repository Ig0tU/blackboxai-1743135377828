<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebScraper Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/lib/core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/lib/languages/json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/github-dark.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        primaryLight: '#7A79E8',
                        primaryDark: '#4645B5',
                        secondary: '#9C9BF0',
                        accent: '#FF8A3D',
                        dark: {
                            bg: '#181818',
                            card: '#252525',
                            input: '#303030',
                            border: '#404040',
                            text: '#E9E9E9'
                        },
                        light: {
                            bg: '#FFFFFF',
                            card: '#F5F5F5',
                            input: '#FFFFFF',
                            border: '#E5E5E5',
                            text: '#333333'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['Fira Code', 'monospace']
                    },
                    boxShadow: {
                        'custom': '0 4px 16px rgba(93, 92, 222, 0.15)',
                        'custom-dark': '0 4px 16px rgba(0, 0, 0, 0.2)'
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-slow': 'bounce 2s infinite'
                    }
                }
            }
        };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap');

        /* Custom Scrollbar */
        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: rgba(93, 92, 222, 0.5) transparent;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: rgba(93, 92, 222, 0.5);
            border-radius: 20px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: rgba(93, 92, 222, 0.7);
        }

        /* Chat animations */
        .chat-bubble {
            max-width: 85%;
            animation: fadeIn 0.5s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .typing-indicator::after {
            content: '';
            display: inline-block;
            vertical-align: bottom;
            width: 24px;
            height: 6px;
            background-image: url("data:image/svg+xml,%3Csvg width='24' height='6' viewBox='0 0 24 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%235D5CDE' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'%3E%3Canimate attributeName='opacity' dur='1s' values='1;.2;1' repeatCount='indefinite' begin='0s'/%3E%3C/circle%3E%3Ccircle cx='12' cy='3' r='3'%3E%3Canimate attributeName='opacity' dur='1s' values='1;.2;1' repeatCount='indefinite' begin='.2s'/%3E%3C/circle%3E%3Ccircle cx='21' cy='3' r='3'%3E%3Canimate attributeName='opacity' dur='1s' values='1;.2;1' repeatCount='indefinite' begin='.4s'/%3E%3C/circle%3E%3C/g%3E%3C/svg%3E");
            background-repeat: no-repeat;
            margin-left: 5px;
        }

        /* JSON Viewer */
        .json-viewer {
            font-family: 'Fira Code', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        .json-item {
            margin-left: 20px;
        }
        .collapsible {
            cursor: pointer;
            user-select: none;
        }
        .collapsible::before {
            content: '▼';
            display: inline-block;
            margin-right: 5px;
            transition: transform 0.2s;
            font-size: 0.7em;
            width: 10px;
        }
        .collapsible.collapsed::before {
            transform: rotate(-90deg);
        }
        
        /* Base64 Preview */
        .base64-preview {
            max-width: 150px;
            max-height: 150px;
            object-fit: contain;
            border-radius: 4px;
            border: 1px solid rgba(93, 92, 222, 0.2);
        }
        
        /* Button and input styles */
        .custom-btn {
            @apply px-4 py-2 bg-primary hover:bg-primaryLight text-white rounded-lg transition-colors duration-200 font-medium flex items-center justify-center;
        }
        .custom-btn-secondary {
            @apply px-4 py-2 bg-gray-200 dark:bg-dark-input hover:bg-gray-300 dark:hover:bg-dark-border text-gray-700 dark:text-dark-text rounded-lg transition-colors duration-200 font-medium flex items-center justify-center;
        }
        .custom-input {
            @apply px-4 py-2.5 rounded-lg border border-light-border dark:border-dark-border bg-light-input dark:bg-dark-input text-light-text dark:text-dark-text focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors duration-200 text-base;
        }
        
        /* Feature Cards */
        .feature-card {
            @apply bg-white dark:bg-dark-card p-4 rounded-lg shadow transition-all duration-200;
        }
        .feature-card:hover {
            @apply shadow-md transform -translate-y-1;
        }
        
        /* Pulse animation for loading states */
        .pulse-bg {
            animation: pulse-bg 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse-bg {
            0%, 100% {
                background-opacity: 1;
            }
            50% {
                background-opacity: .7;
            }
        }
        
        /* Status indicators */
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }
        .status-dot.active {
            background-color: #10B981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
        }
        .status-dot.processing {
            background-color: #F59E0B;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
            animation: pulse 2s infinite;
        }
        .status-dot.error {
            background-color: #EF4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: #5D5CDE;
        }
        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }
        
        /* Tab transitions */
        .tab-content {
            transition: opacity 0.2s ease-in-out;
        }
        .tab-content.hidden {
            opacity: 0;
            height: 0;
            overflow: hidden;
        }
        
        /* Highlight.js custom styles */
        .hljs {
            padding: 1em;
            border-radius: 0.5rem;
            max-height: 600px;
            overflow: auto;
        }
        .dark .hljs {
            background: #1E1E1E !important;
        }
        
        /* Image grid */
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 16px;
        }
        .image-card {
            border-radius: 8px;
            overflow: hidden;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            aspect-ratio: 1;
        }
        .dark .image-card {
            background: #2A2A2A;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .image-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        .image-card:hover img {
            transform: scale(1.05);
        }
        
        /* Processing indicator */
        .processing-indicator {
            position: relative;
            width: 100%;
            height: 4px;
            overflow: hidden;
            background-color: rgba(93, 92, 222, 0.1);
            border-radius: 2px;
        }
        .processing-indicator:after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 50%;
            background-color: #5D5CDE;
            animation: loading 1.5s infinite ease-in-out;
            border-radius: 2px;
        }
        @keyframes loading {
            0% {
                left: -50%;
            }
            100% {
                left: 100%;
            }
        }
    </style>
</head>
<body class="transition-colors duration-300 bg-light-bg dark:bg-dark-bg text-light-text dark:text-dark-text">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <header class="mb-6 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <div>
                <h1 class="text-3xl font-bold text-primary flex items-center">
                    <svg class="w-8 h-8 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 4C10.6193 4 9.5 5.11929 9.5 6.5C9.5 7.88071 10.6193 9 12 9C13.3807 9 14.5 7.88071 14.5 6.5C14.5 5.11929 13.3807 4 12 4Z" fill="#5D5CDE"/>
                        <path d="M12 10C9.79086 10 8 11.7909 8 14V17C8 17.5523 8.44772 18 9 18H15C15.5523 18 16 17.5523 16 17V14C16 11.7909 14.2091 10 12 10Z" fill="#5D5CDE"/>
                        <path d="M2 6C2 4.89543 2.89543 4 4 4H6C6.55228 4 7 4.44772 7 5V8C7 8.55228 6.55228 9 6 9H3C2.44772 9 2 8.55228 2 8V6Z" fill="#7A79E8"/>
                        <path d="M17 5C17 4.44772 17.4477 4 18 4H20C21.1046 4 22 4.89543 22 6V8C22 8.55228 21.5523 9 21 9H18C17.4477 9 17 8.55228 17 8V5Z" fill="#7A79E8"/>
                        <path d="M2 16C2 14.8954 2.89543 14 4 14H6C6.55228 14 7 14.4477 7 15V18C7 18.5523 6.55228 19 6 19H3C2.44772 19 2 18.5523 2 18V16Z" fill="#7A79E8"/>
                        <path d="M17 15C17 14.4477 17.4477 14 18 14H20C21.1046 14 22 14.8954 22 16V18C22 18.5523 21.5523 19 21 19H18C17.4477 19 17 18.5523 17 18V15Z" fill="#7A79E8"/>
                    </svg>
                    WebScraper Pro
                </h1>
                <p class="text-gray-600 dark:text-gray-300 mt-1 max-w-2xl">Advanced web data extraction with comprehensive scraping, visualization, and analysis</p>
            </div>
            
            <div class="flex items-center space-x-3">
                <button id="theme-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-dark-card transition-colors">
                    <!-- Sun icon -->
                    <svg id="light-icon" class="w-6 h-6 hidden dark:block text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                    </svg>
                    <!-- Moon icon -->
                    <svg id="dark-icon" class="w-6 h-6 block dark:hidden text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                    </svg>
                </button>
                
                <div class="relative">
                    <button id="settings-btn" class="p-2 rounded-full bg-gray-200 dark:bg-dark-card hover:bg-gray-300 dark:hover:bg-dark-border transition-colors">
                        <svg class="w-6 h-6 text-gray-700 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                    </button>
                    
                    <div id="settings-menu" class="absolute right-0 mt-2 w-60 bg-white dark:bg-dark-card rounded-lg shadow-lg z-10 hidden">
                        <div class="p-4">
                            <h3 class="font-medium text-gray-900 dark:text-white">Settings</h3>
                            <div class="mt-4 space-y-3">
                                <div class="flex items-center justify-between">
                                    <label class="text-sm text-gray-700 dark:text-gray-300">API Key</label>
                                    <input type="password" id="api-key" class="ml-2 p-1 text-xs w-32 rounded border border-gray-300 dark:border-gray-600 dark:bg-dark-input" placeholder="Enter API key">
                                </div>
                                <div class="flex items-center justify-between">
                                    <label class="text-sm text-gray-700 dark:text-gray-300">Auto Extract</label>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="auto-extract" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <label class="text-sm text-gray-700 dark:text-gray-300">Extract Images</label>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="extract-images" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <label class="text-sm text-gray-700 dark:text-gray-300">Extract Scripts</label>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="extract-scripts" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <button id="save-settings" class="mt-4 w-full px-3 py-1.5 text-sm bg-primary text-white rounded transition-colors hover:bg-primaryLight">
                                Save Settings
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <!-- Chat Section -->
            <div class="lg:col-span-7 xl:col-span-8 flex flex-col h-[75vh] bg-light-card dark:bg-dark-card rounded-lg shadow-custom dark:shadow-custom-dark overflow-hidden">
                <div id="chat-window" class="custom-scrollbar flex-1 overflow-y-auto p-6 space-y-4">
                    <!-- Welcome message will be inserted here -->
                </div>
                <div class="p-4 border-t border-gray-200 dark:border-dark-border">
                    <div class="relative">
                        <input id="user-input" type="text" placeholder="Enter a URL or ask for data extraction help..." 
                               class="w-full custom-input pr-12" />
                        <button id="send-btn" class="absolute right-2 top-2 p-2 text-primary hover:text-primaryLight transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="lg:col-span-5 xl:col-span-4 space-y-6">
                <!-- Main Controls -->
                <div class="bg-light-card dark:bg-dark-card rounded-lg shadow-custom dark:shadow-custom-dark p-5">
                    <div class="tabs flex border-b border-gray-200 dark:border-dark-border mb-4 overflow-x-auto">
                        <button data-tab="extract" class="px-4 py-2 border-b-2 border-primary font-medium text-primary whitespace-nowrap">Extract</button>
                        <button data-tab="visualize" class="px-4 py-2 border-b-2 border-transparent font-medium text-gray-600 dark:text-gray-400 whitespace-nowrap">Visualize</button>
                        <button data-tab="analyze" class="px-4 py-2 border-b-2 border-transparent font-medium text-gray-600 dark:text-gray-400 whitespace-nowrap">Analyze</button>
                        <button data-tab="export" class="px-4 py-2 border-b-2 border-transparent font-medium text-gray-600 dark:text-gray-400 whitespace-nowrap">Export</button>
                    </div>

                    <!-- Extract Tab -->
                    <div data-tab-content="extract" class="tab-content">
                        <div class="mb-4">
                            <label class="block mb-2 text-sm font-medium">URL to Extract</label>
                            <div class="flex space-x-2">
                                <input id="url-input" type="text" placeholder="https://example.com" class="flex-1 custom-input">
                                <button id="extract-btn" class="custom-btn">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                    </svg>
                                    Extract
                                </button>
                            </div>
                        </div>
                        <div class="mb-4">
                            <p class="text-sm text-center text-gray-600 dark:text-gray-400 my-2">- OR -</p>
                        </div>
                        <div class="border-2 border-dashed border-gray-300 dark:border-dark-border rounded-lg p-6 text-center">
                            <svg class="w-12 h-12 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">Drag & drop files here or</p>
                            <input type="file" id="file-input" class="hidden" />
                            <label for="file-input" class="mt-2 inline-block custom-btn cursor-pointer">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path>
                                </svg>
                                Browse Files
                            </label>
                            <p id="file-name" class="mt-2 text-sm text-gray-600 dark:text-gray-400"></p>
                        </div>
                        <button id="process-file-btn" class="mt-4 custom-btn w-full">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Process File
                        </button>
                    </div>

                    <!-- Visualize Tab -->
                    <div data-tab-content="visualize" class="tab-content hidden">
                        <div class="mb-4">
                            <label class="block mb-2 text-sm font-medium">Visualization Type</label>
                            <select id="viz-type" class="w-full custom-input">
                                <option value="dom-tree">DOM Structure</option>
                                <option value="content-breakdown">Content Breakdown</option>
                                <option value="link-graph">Link Relationships</option>
                                <option value="word-cloud">Word Cloud</option>
                                <option value="image-gallery">Image Gallery</option>
                            </select>
                        </div>
                        <div id="viz-options" class="mb-4">
                            <!-- Dynamic options based on visualization type -->
                        </div>
                        <button id="generate-viz-btn" class="custom-btn w-full">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            Generate Visualization
                        </button>
                        <div id="viz-container" class="mt-4 p-4 bg-white dark:bg-gray-800 rounded-lg flex justify-center items-center h-[200px]">
                            <p class="text-gray-500 dark:text-gray-400 text-center">Extract data first to visualize</p>
                        </div>
                    </div>

                    <!-- Analyze Tab -->
                    <div data-tab-content="analyze" class="tab-content hidden">
                        <div class="mb-4">
                            <label class="block mb-2 text-sm font-medium">Analysis Type</label>
                            <select id="analysis-type" class="w-full custom-input">
                                <option value="content-analysis">Content Analysis</option>
                                <option value="seo-analysis">SEO Analysis</option>
                                <option value="sentiment-analysis">Sentiment Analysis</option>
                                <option value="entity-extraction">Entity Extraction</option>
                                <option value="tech-stack">Tech Stack Detection</option>
                            </select>
                        </div>
                        <button id="run-analysis-btn" class="custom-btn w-full">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                            Run Analysis
                        </button>
                        <div id="analysis-result" class="mt-4 bg-white dark:bg-gray-800 rounded-lg p-4 h-[250px] overflow-y-auto custom-scrollbar">
                            <p class="text-gray-500 dark:text-gray-400 text-center">Analysis results will appear here</p>
                        </div>
                    </div>

                    <!-- Export Tab -->
                    <div data-tab-content="export" class="tab-content hidden">
                        <div class="mb-4">
                            <label class="block mb-2 text-sm font-medium">Export Format</label>
                            <select id="export-format" class="w-full custom-input">
                                <option value="json">JSON</option>
                                <option value="csv">CSV</option>
                                <option value="html">HTML</option>
                                <option value="md">Markdown</option>
                                <option value="qr">QR Code</option>
                            </select>
                        </div>
                        <div id="export-options" class="mb-4">
                            <!-- Dynamic export options -->
                            <div id="json-options">
                                <label class="inline-flex items-center mb-2">
                                    <input type="checkbox" id="pretty-json" class="mr-2" checked>
                                    <span class="text-sm">Pretty Print</span>
                                </label>
                                <label class="block mb-2 text-sm font-medium">Data to Export</label>
                                <select id="json-export-data" class="w-full custom-input">
                                    <option value="all">All Data</option>
                                    <option value="text">Text Only</option>
                                    <option value="links">Links Only</option>
                                    <option value="images">Images Only</option>
                                    <option value="metadata">Metadata Only</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button id="generate-export-btn" class="custom-btn flex-1">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                                Generate
                            </button>
                            <button id="copy-export-btn" class="custom-btn-secondary">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                                </svg>
                                Copy
                            </button>
                        </div>
                        <div id="export-result" class="mt-4 bg-white dark:bg-gray-800 rounded-lg p-4 h-[200px] overflow-auto custom-scrollbar">
                            <p class="text-gray-500 dark:text-gray-400 text-center">Export result will appear here</p>
                        </div>
                    </div>
                </div>

                <!-- Status Panel -->
                <div class="bg-light-card dark:bg-dark-card rounded-lg shadow-custom dark:shadow-custom-dark p-4">
                    <div class="flex justify-between items-center">
                        <h3 class="font-semibold text-gray-800 dark:text-gray-200">Status</h3>
                        <div id="status-indicator" class="flex items-center">
                            <span class="status-dot active"></span>
                            <span class="text-sm text-gray-600 dark:text-gray-400">Ready</span>
                        </div>
                    </div>
                    <div id="status-details" class="mt-3 text-sm text-gray-600 dark:text-gray-400">
                        <div class="flex justify-between">
                            <span>Total Extracted:</span>
                            <span id="extracted-count">0 items</span>
                        </div>
                        <div class="flex justify-between mt-1">
                            <span>Data Size:</span>
                            <span id="data-size">0 KB</span>
                        </div>
                        <div class="flex justify-between mt-1">
                            <span>Last Updated:</span>
                            <span id="last-updated">Never</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Area -->
        <div id="results-container" class="mt-6 bg-light-card dark:bg-dark-card rounded-lg shadow-custom dark:shadow-custom-dark p-6 hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Extracted Data</h2>
                <div class="flex space-x-2">
                    <select id="view-mode" class="custom-input py-1.5 text-sm">
                        <option value="tree">Interactive Tree</option>
                        <option value="pretty">Pretty JSON</option>
                        <option value="raw">Raw JSON</option>
                        <option value="summary">Summary</option>
                    </select>
                    <button id="collapse-results" class="p-2 bg-gray-200 dark:bg-dark-input hover:bg-gray-300 dark:hover:bg-dark-border rounded-lg transition-colors">
                        <svg class="w-5 h-5 text-gray-700 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div id="results-content" class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 min-h-[300px] max-h-[600px] overflow-y-auto custom-scrollbar"></div>
        </div>

        <!-- Gallery Container -->
        <div id="gallery-container" class="mt-6 bg-light-card dark:bg-dark-card rounded-lg shadow-custom dark:shadow-custom-dark p-6 hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Extracted Media</h2>
                <button id="collapse-gallery" class="p-2 bg-gray-200 dark:bg-dark-input hover:bg-gray-300 dark:hover:bg-dark-border rounded-lg transition-colors">
                    <svg class="w-5 h-5 text-gray-700 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
            </div>
            <div id="gallery-content" class="image-grid min-h-[200px]">
                <!-- Images will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // Check for dark mode preference
        function initTheme() {
            if (localStorage.getItem('theme') === 'dark' || 
                (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }

        initTheme();
        
        // Initialize the app when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Element references - Main UI
            const chatWindow = document.getElementById('chat-window');
            const userInput = document.getElementById('user-input');
            const sendBtn = document.getElementById('send-btn');
            const themeToggle = document.getElementById('theme-toggle');
            const settingsBtn = document.getElementById('settings-btn');
            const settingsMenu = document.getElementById('settings-menu');
            const saveSettings = document.getElementById('save-settings');
            
            // Element references - Tab controls
            const tabButtons = document.querySelectorAll('.tabs button');
            const tabContents = document.querySelectorAll('[data-tab-content]');
            
            // Element references - URL and file input
            const urlInput = document.getElementById('url-input');
            const extractBtn = document.getElementById('extract-btn');
            const fileInput = document.getElementById('file-input');
            const fileName = document.getElementById('file-name');
            const processFileBtn = document.getElementById('process-file-btn');
            
            // Element references - Export controls
            const exportFormat = document.getElementById('export-format');
            const exportOptions = document.getElementById('export-options');
            const generateExportBtn = document.getElementById('generate-export-btn');
            const copyExportBtn = document.getElementById('copy-export-btn');
            const exportResult = document.getElementById('export-result');
            
            // Element references - Visualization
            const vizType = document.getElementById('viz-type');
            const vizOptions = document.getElementById('viz-options');
            const generateVizBtn = document.getElementById('generate-viz-btn');
            const vizContainer = document.getElementById('viz-container');
            
            // Element references - Analysis
            const analysisType = document.getElementById('analysis-type');
            const runAnalysisBtn = document.getElementById('run-analysis-btn');
            const analysisResult = document.getElementById('analysis-result');
            
            // Element references - Status panel
            const statusIndicator = document.getElementById('status-indicator');
            const extractedCount = document.getElementById('extracted-count');
            const dataSize = document.getElementById('data-size');
            const lastUpdated = document.getElementById('last-updated');
            
            // Element references - Results
            const resultsContainer = document.getElementById('results-container');
            const resultsContent = document.getElementById('results-content');
            const viewMode = document.getElementById('view-mode');
            const collapseResults = document.getElementById('collapse-results');
            
            // Element references - Gallery
            const galleryContainer = document.getElementById('gallery-container');
            const galleryContent = document.getElementById('gallery-content');
            const collapseGallery = document.getElementById('collapse-gallery');
            
            // State
            let appSettings = {
                apiKey: localStorage.getItem('apiKey') || '',
                autoExtract: localStorage.getItem('autoExtract') !== 'false',
                extractImages: localStorage.getItem('extractImages') !== 'false',
                extractScripts: localStorage.getItem('extractScripts') !== 'false'
            };
            
            // Extracted data storage
            let extractedData = {
                source: '',
                url: '',
                timestamp: '',
                metadata: {},
                text: [],
                links: [],
                images: [],
                styles: [],
                scripts: [],
                forms: [],
                media: [],
                domTree: {},
                base64Files: []
            };
            
            let extractedDataHistory = [];
            
            // Load settings into UI
            document.getElementById('api-key').value = appSettings.apiKey;
            document.getElementById('auto-extract').checked = appSettings.autoExtract;
            document.getElementById('extract-images').checked = appSettings.extractImages;
            document.getElementById('extract-scripts').checked = appSettings.extractScripts;
            
            // Initialize chat with welcome message
            addBotMessage(`# Welcome to WebScraper Pro!

I'll help you extract comprehensive data from websites and files:

* **Complete DOM extraction** with all elements, attributes and relationships
* **All text content** - visible and hidden, with full formatting context
* **Images and media** encoded as base64 for complete portability
* **Metadata** from all sources (meta tags, Open Graph, schema.org, etc.)
* **Links, scripts, styles, and forms** with full attributes and content

You can also visualize, analyze and export the extracted data in multiple formats.

**To get started:**
* Enter a URL to extract website data
* Upload a file to process its content
* Ask me specific questions about web scraping

What would you like to extract today?`);

            // Theme toggle
            themeToggle.addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
            });
            
            // Settings menu toggle
            settingsBtn.addEventListener('click', () => {
                settingsMenu.classList.toggle('hidden');
            });
            
            // Close settings when clicking elsewhere
            document.addEventListener('click', (e) => {
                if (!settingsBtn.contains(e.target) && !settingsMenu.contains(e.target)) {
                    settingsMenu.classList.add('hidden');
                }
            });
            
            // Save settings
            saveSettings.addEventListener('click', () => {
                appSettings.apiKey = document.getElementById('api-key').value;
                appSettings.autoExtract = document.getElementById('auto-extract').checked;
                appSettings.extractImages = document.getElementById('extract-images').checked;
                appSettings.extractScripts = document.getElementById('extract-scripts').checked;
                
                // Save to localStorage
                localStorage.setItem('apiKey', appSettings.apiKey);
                localStorage.setItem('autoExtract', appSettings.autoExtract);
                localStorage.setItem('extractImages', appSettings.extractImages);
                localStorage.setItem('extractScripts', appSettings.extractScripts);
                
                settingsMenu.classList.add('hidden');
                addBotMessage('Settings saved successfully!');
            });

            // Tab switching logic
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active class from all buttons and hide all content
                    tabButtons.forEach(b => {
                        b.classList.remove('border-primary', 'text-primary');
                        b.classList.add('border-transparent', 'text-gray-600', 'dark:text-gray-400');
                    });
                    tabContents.forEach(c => c.classList.add('hidden'));

                    // Add active class to clicked button and show corresponding content
                    button.classList.add('border-primary', 'text-primary');
                    button.classList.remove('border-transparent', 'text-gray-600', 'dark:text-gray-400');
                    
                    const tabName = button.getAttribute('data-tab');
                    document.querySelector(`[data-tab-content="${tabName}"]`).classList.remove('hidden');
                    
                    // Handle specific tab interactions
                    if (tabName === 'visualize') {
                        updateVizOptions();
                    } else if (tabName === 'export') {
                        updateExportOptions();
                    }
                });
            });

            // File input handling
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    fileName.textContent = e.target.files[0].name;
                }
            });
            
            // Setup drag and drop for file input
            const dropZone = fileInput.parentElement;
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropZone.classList.add('bg-gray-100', 'dark:bg-dark-input');
            }
            
            function unhighlight() {
                dropZone.classList.remove('bg-gray-100', 'dark:bg-dark-input');
            }
            
            dropZone.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    fileInput.files = files;
                    fileName.textContent = files[0].name;
                }
            }

            // Extract button click handler
            extractBtn.addEventListener('click', () => {
                const url = urlInput.value.trim();
                if (url) {
                    extractFromUrl(url);
                } else {
                    addBotMessage("Please enter a valid URL to extract data from.");
                }
            });

            // Process file button click handler
            processFileBtn.addEventListener('click', () => {
                if (fileInput.files.length > 0) {
                    processFile(fileInput.files[0]);
                } else {
                    addBotMessage("Please select a file to process.");
                }
            });
            
            // Generate visualization button click handler
            generateVizBtn.addEventListener('click', () => {
                generateVisualization();
            });
            
            // Run analysis button click handler
            runAnalysisBtn.addEventListener('click', () => {
                runAnalysis();
            });
            
            // Generate export button click handler
            generateExportBtn.addEventListener('click', () => {
                generateExport();
            });
            
            // Copy export button click handler
            copyExportBtn.addEventListener('click', () => {
                copyExport();
            });
            
            // View mode change handler
            viewMode.addEventListener('change', () => {
                updateResultsView();
            });
            
            // Collapse/expand results
            collapseResults.addEventListener('click', () => {
                resultsContainer.classList.toggle('hidden');
            });
            
            // Collapse/expand gallery
            collapseGallery.addEventListener('click', () => {
                galleryContainer.classList.toggle('hidden');
            });
            
            // Export format change handler
            exportFormat.addEventListener('change', () => {
                updateExportOptions();
            });
            
            // Visualization type change handler
            vizType.addEventListener('change', () => {
                updateVizOptions();
            });

            // Send button click handler
            sendBtn.addEventListener('click', () => {
                sendUserMessage();
            });

            // Enter key press handler
            userInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendUserMessage();
                }
            });

            // Send user message to the chat
            function sendUserMessage() {
                const message = userInput.value.trim();
                if (message) {
                    addUserMessage(message);
                    userInput.value = '';
                    
                    // Process the user's message
                    processUserMessage(message);
                }
            }

            // Add user message to chat
            function addUserMessage(text) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-bubble ml-auto bg-primary text-white p-3 rounded-lg rounded-tr-none';
                messageDiv.textContent = text;
                
                const messageContainer = document.createElement('div');
                messageContainer.className = 'flex justify-end';
                messageContainer.appendChild(messageDiv);
                
                chatWindow.appendChild(messageContainer);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }

            // Add bot message to chat
            function addBotMessage(text, isLoading = false) {
                // Remove any existing loading indicators
                const loadingIndicators = chatWindow.querySelectorAll('.typing-indicator');
                loadingIndicators.forEach(indicator => indicator.parentElement.parentElement.remove());
                
                // Create message element
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-bubble bg-light-card dark:bg-dark-card p-3 rounded-lg rounded-tl-none';
                
                if (isLoading) {
                    messageDiv.classList.add('typing-indicator');
                    messageDiv.innerHTML = 'Processing';
                } else {
                    messageDiv.innerHTML = DOMPurify.sanitize(marked.parse(text));
                }
                
                const messageContainer = document.createElement('div');
                messageContainer.className = 'flex';
                messageContainer.appendChild(messageDiv);
                
                chatWindow.appendChild(messageContainer);
                chatWindow.scrollTop = chatWindow.scrollHeight;
                
                return messageDiv;
            }

            // Process user's natural language message
            function processUserMessage(message) {
                // Show thinking indicator
                const thinkingIndicator = addBotMessage('', true);
                
                // Check if message is a URL
                if (isURL(message)) {
                    // Auto-extract if setting is enabled
                    if (appSettings.autoExtract) {
                        urlInput.value = message;
                        thinkingIndicator.remove();
                        extractFromUrl(message);
                    } else {
                        setTimeout(() => {
                            thinkingIndicator.remove();
                            addBotMessage(`I've detected a URL. Would you like me to extract data from it?

\`${message}\`

Click the "Extract" button or type "yes" to proceed.`);
                            urlInput.value = message;
                            document.querySelector('[data-tab="extract"]').click();
                        }, 800);
                    }
                    return;
                }
                
                // Process command words
                if (/^(yes|extract|scrape)/i.test(message) && urlInput.value.trim()) {
                    thinkingIndicator.remove();
                    extractFromUrl(urlInput.value.trim());
                    return;
                }
                
                // In a real implementation, this is where we'd integrate with Claude through the Poe API
                // For this demo, we'll simulate natural language processing with a timeout for realism
                setTimeout(() => {
                    thinkingIndicator.remove();
                    
                    // Simple language pattern matching
                    if (message.toLowerCase().includes('extract') && message.toLowerCase().includes('url')) {
                        addBotMessage(`To extract data from a URL:

1. Enter the URL in the "URL to Extract" field
2. Click the "Extract" button

You can also directly paste a URL into the chat, and I'll detect it automatically.

Would you like me to extract data from a specific URL?`);
                    } 
                    else if (message.toLowerCase().includes('process') && message.toLowerCase().includes('file')) {
                        addBotMessage(`To process a file:

1. Upload your file using the file uploader in the Extract tab
2. Click the "Process File" button

I can extract and analyze content from various file types including HTML, XML, JSON, text, and binary files. Binary files will be automatically encoded as base64.`);
                    }
                    else if (message.toLowerCase().includes('visualize') || message.toLowerCase().includes('visualization')) {
                        addBotMessage(`I can create various visualizations from your extracted data:

- **DOM Structure** - Interactive tree view of the page structure
- **Content Breakdown** - Charts showing the distribution of content types
- **Link Relationships** - Network graph of internal/external links
- **Word Cloud** - Visual representation of common words
- **Image Gallery** - Grid view of all extracted images

To create a visualization:
1. Extract data from a URL or file first
2. Go to the Visualize tab
3. Select the visualization type
4. Click "Generate Visualization"`);
                        document.querySelector('[data-tab="visualize"]').click();
                    }
                    else if (message.toLowerCase().includes('analyze') || message.toLowerCase().includes('analysis')) {
                        addBotMessage(`I can perform various types of analysis on the extracted data:

- **Content Analysis** - Text statistics, readability scores, content structure
- **SEO Analysis** - Meta tags, headings, keyword density, canonical URLs
- **Sentiment Analysis** - Detect positive/negative sentiment in text
- **Entity Extraction** - Identify people, organizations, locations, dates
- **Tech Stack Detection** - Identify frameworks, libraries, and technologies

To run an analysis:
1. Extract data from a URL or file first
2. Go to the Analyze tab
3. Select the analysis type
4. Click "Run Analysis"`);
                        document.querySelector('[data-tab="analyze"]').click();
                    }
                    else if (message.toLowerCase().includes('export')) {
                        addBotMessage(`You can export the extracted data in various formats:

- **JSON** - Complete structured data
- **CSV** - Tabular data (for links, images, etc.)
- **HTML** - Formatted report
- **Markdown** - Portable text format
- **QR Code** - Visual encoding of key data or URLs

To export your data:
1. Extract data from a URL or file first
2. Go to the Export tab
3. Select the export format and options
4. Click "Generate" to create the export
5. Use "Copy" to copy the result to clipboard`);
                        document.querySelector('[data-tab="export"]').click();
                    }
                    else if (message.toLowerCase().includes('help') || message.toLowerCase().includes('what can you do')) {
                        addBotMessage(`# WebScraper Pro Capabilities

I can help you extract, process, visualize, analyze, and export web data:

## 🌐 Data Extraction
- Extract complete website content with DOM structure
- Process uploaded files (HTML, XML, JSON, text, binary)
- Encode all binary content (images, etc.) as base64
- Preserve all metadata and attributes

## 📊 Visualization
- DOM structure visualization
- Content breakdown charts
- Link relationship graphs
- Word clouds from text content
- Image galleries from extracted media

## 🔎 Analysis
- Content analysis (stats, readability, structure)
- SEO analysis (meta tags, headings, etc.)
- Sentiment analysis of text content
- Entity extraction (people, places, etc.)
- Technology stack detection

## 📤 Export
- Multiple export formats (JSON, CSV, HTML, Markdown)
- QR code generation
- Customizable export options
- Copy to clipboard functionality

Just tell me what you'd like to do or enter a URL to get started!`);
                    }
                    else {
                        addBotMessage(`I'm here to help you extract and analyze web data. You can:

- Enter a URL to extract website data
- Upload a file to process its content
- Ask me about specific extraction features
- Request visualizations or analysis of extracted data
- Export data in various formats

If you have a specific URL you want to analyze, you can paste it directly in the chat.`);
                    }
                }, 1000);
            }

            // Extract data from URL (simulated for the demo)
            function extractFromUrl(url) {
                // Update status
                updateStatus('processing', 'Extracting data from URL...', '0 items', '0 KB', 'In progress');
                
                // Show loading message
                const loadingMessage = addBotMessage('', true);
                
                // In a real implementation, this would call Claude through the Poe API
                // For this demo, we'll simulate extraction with a timeout
                setTimeout(() => {
                    loadingMessage.remove();
                    
                    try {
                        // Extract domain for simulation
                        const domain = extractDomain(url);
                        
                        // Create simulated comprehensive data
                        extractedData = createComprehensiveWebsiteData(url, domain);
                        
                        // Add to history
                        extractedDataHistory.unshift({
                            url: url,
                            timestamp: new Date().toISOString(),
                            data: JSON.parse(JSON.stringify(extractedData)) // Deep copy
                        });
                        
                        // Limit history to 10 items
                        if (extractedDataHistory.length > 10) {
                            extractedDataHistory.pop();
                        }
                        
                        // Update results view
                        updateResultsView();
                        resultsContainer.classList.remove('hidden');
                        
                        // Update gallery if there are images
                        if (extractedData.images && extractedData.images.length > 0) {
                            updateGallery();
                            galleryContainer.classList.remove('hidden');
                        }
                        
                        // Update status
                        const totalItems = countTotalItems(extractedData);
                        const jsonSize = calculateJsonSize(extractedData);
                        updateStatus('active', 'Extraction complete', 
                                     `${totalItems} items`, 
                                     formatBytes(jsonSize), 
                                     new Date().toLocaleString());
                        
                        // Create success message with stats
                        const stats = generateDataStats(extractedData);
                        addBotMessage(`## 🎉 Extraction Complete!

Successfully extracted all data from **${url}**:

**Content Overview:**
- **${stats.text}** text elements
- **${stats.images}** images (with base64 encoding)
- **${stats.links}** links (${stats.internalLinks} internal, ${stats.externalLinks} external)
- **${stats.scripts}** script elements
- **${stats.styles}** style elements
- **${Object.keys(stats.metadata).length}** metadata fields
- Complete DOM tree with **${stats.domElements}** elements

**What would you like to do with this data?**
- 📊 **Visualize** in the Visualize tab
- 🔎 **Analyze** content in the Analyze tab
- 📤 **Export** in various formats in the Export tab
- 🖼️ Browse **image gallery** below`);
                        
                    } catch (error) {
                        addBotMessage(`⚠️ Error extracting data: ${error.message}`);
                        updateStatus('error', 'Extraction failed', '0 items', '0 KB', new Date().toLocaleString());
                    }
                }, 2000);
            }

            // Process uploaded file
            function processFile(file) {
                // Update status
                updateStatus('processing', `Processing file: ${file.name}...`, '0 items', '0 KB', 'In progress');
                
                // Show loading message
                const loadingMessage = addBotMessage('', true);
                
                // Determine file type
                const fileType = file.type || 'application/octet-stream';
                const isTextFile = fileType.startsWith('text/') || 
                                  fileType === 'application/json' || 
                                  fileType === 'application/xml' ||
                                  /\.(txt|html|htm|xml|json|csv|md)$/i.test(file.name);
                
                if (isTextFile) {
                    // Process as text file
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        // Create a timeout to simulate processing
                        setTimeout(() => {
                            loadingMessage.remove();
                            processTextFile(file, e.target.result);
                        }, 1500);
                    };
                    
                    reader.onerror = function() {
                        loadingMessage.remove();
                        addBotMessage(`⚠️ Error reading file: ${reader.error.message}`);
                        updateStatus('error', 'File processing failed', '0 items', '0 KB', new Date().toLocaleString());
                    };
                    
                    reader.readAsText(file);
                } else {
                    // Process as binary file
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        // Create a timeout to simulate processing
                        setTimeout(() => {
                            loadingMessage.remove();
                            processBinaryFile(file, e.target.result);
                        }, 1500);
                    };
                    
                    reader.onerror = function() {
                        loadingMessage.remove();
                        addBotMessage(`⚠️ Error reading file: ${reader.error.message}`);
                        updateStatus('error', 'File processing failed', '0 items', '0 KB', new Date().toLocaleString());
                    };
                    
                    reader.readAsDataURL(file);
                }
            }
            
            // Process text file
            function processTextFile(file, content) {
                try {
                    // Analyze text content
                    const textAnalysis = analyzeText(content);
                    
                    // Create data structure
                    extractedData = {
                        source: 'file',
                        filename: file.name,
                        fileType: file.type || 'text/plain',
                        fileSize: file.size,
                        timestamp: new Date().toISOString(),
                        metadata: {
                            name: file.name,
                            type: file.type || 'text/plain',
                            size: file.size,
                            lastModified: new Date(file.lastModified).toISOString(),
                            encoding: 'UTF-8',
                            lineCount: content.split('\n').length,
                            charCount: content.length
                        },
                        content: content,
                        textAnalysis: textAnalysis
                    };
                    
                    // Try to parse as JSON if applicable
                    if (file.type === 'application/json' || file.name.endsWith('.json')) {
                        try {
                            extractedData.parsedJson = JSON.parse(content);
                        } catch (e) {
                            extractedData.jsonParseError = e.message;
                        }
                    }
                    
                    // Try to parse as HTML if applicable
                    if (file.type === 'text/html' || file.name.endsWith('.html') || file.name.endsWith('.htm')) {
                        extractedData.htmlContent = true;
                        // In a real implementation, we would use DOMParser to extract structured content
                    }
                    
                    // Add to history
                    extractedDataHistory.unshift({
                        filename: file.name,
                        timestamp: new Date().toISOString(),
                        data: JSON.parse(JSON.stringify(extractedData)) // Deep copy
                    });
                    
                    // Update results view
                    updateResultsView();
                    resultsContainer.classList.remove('hidden');
                    
                    // Update status
                    updateStatus('active', 'File processing complete', 
                                 `1 file (${textAnalysis.wordCount} words)`, 
                                 formatBytes(calculateJsonSize(extractedData)), 
                                 new Date().toLocaleString());
                    
                    // Generate success message
                    addBotMessage(`## 📄 File Processing Complete!

Successfully processed **${file.name}** (${formatBytes(file.size)}):

**Content Overview:**
- **${textAnalysis.wordCount}** words
- **${textAnalysis.sentenceCount}** sentences
- **${textAnalysis.paragraphCount}** paragraphs
- **${extractedData.metadata.lineCount}** lines
- **${extractedData.metadata.charCount}** characters

**Top words**: ${getTopWordsFormatted(textAnalysis.wordFrequency)}

**What would you like to do with this data?**
- 📊 **Visualize** word frequency in the Visualize tab
- 🔎 **Analyze** content in the Analyze tab
- 📤 **Export** in various formats in the Export tab`);
                    
                } catch (error) {
                    addBotMessage(`⚠️ Error processing text file: ${error.message}`);
                    updateStatus('error', 'File processing failed', '0 items', '0 KB', new Date().toLocaleString());
                }
            }
            
            // Process binary file
            function processBinaryFile(file, dataUrl) {
                try {
                    // Extract the base64 part from the dataURL
                    const base64Data = dataUrl.split(',')[1];
                    
                    // Create data structure
                    extractedData = {
                        source: 'file',
                        filename: file.name,
                        fileType: file.type || 'application/octet-stream',
                        fileSize: file.size,
                        timestamp: new Date().toISOString(),
                        metadata: {
                            name: file.name,
                            type: file.type || 'application/octet-stream',
                            size: file.size,
                            lastModified: new Date(file.lastModified).toISOString()
                        },
                        base64Data: base64Data,
                        dataUrl: dataUrl
                    };
                    
                    // Add image-specific metadata if applicable
                    if (file.type.startsWith('image/')) {
                        // In a real implementation, we would create an image element
                        // to get dimensions and other properties
                        extractedData.isImage = true;
                        
                        // Create temporary image to get dimensions
                        const img = new Image();
                        img.onload = function() {
                            extractedData.metadata.dimensions = {
                                width: img.width,
                                height: img.height,
                                aspectRatio: (img.width / img.height).toFixed(2)
                            };
                            
                            // Update image preview in gallery
                            updateGallery();
                        };
                        img.src = dataUrl;
                        
                        // Add to images array for gallery
                        extractedData.images = [{
                            source: 'file',
                            filename: file.name,
                            mimeType: file.type,
                            dataUrl: dataUrl
                        }];
                        
                        // Show gallery
                        updateGallery();
                        galleryContainer.classList.remove('hidden');
                    }
                    
                    // Add to history
                    extractedDataHistory.unshift({
                        filename: file.name,
                        timestamp: new Date().toISOString(),
                        data: JSON.parse(JSON.stringify(extractedData)) // Deep copy
                    });
                    
                    // Update results view
                    updateResultsView();
                    resultsContainer.classList.remove('hidden');
                    
                    // Update status
                    updateStatus('active', 'File processing complete', 
                                 '1 file', 
                                 formatBytes(file.size), 
                                 new Date().toLocaleString());
                    
                    // Generate success message
                    const fileDescription = file.type.startsWith('image/') ? 'image' : 'binary file';
                    
                    addBotMessage(`## 📦 ${fileDescription.charAt(0).toUpperCase() + fileDescription.slice(1)} Processing Complete!

Successfully processed **${file.name}** (${formatBytes(file.size)}):

**File Details:**
- **Type**: ${file.type || 'application/octet-stream'}
- **Size**: ${formatBytes(file.size)}
${file.type.startsWith('image/') ? `- **Dimensions**: Loading image dimensions...` : ''}
- **Base64 encoded**: ✅

${file.type.startsWith('image/') ? `The image preview is available in the gallery below.` : ''}

**What would you like to do with this data?**
- 📤 **Export** the base64 data in the Export tab
${file.type.startsWith('image/') ? '- 🖼️ View the **image** in the gallery below' : ''}
- 🔎 **Analyze** binary properties in the Analyze tab`);
                    
                } catch (error) {
                    addBotMessage(`⚠️ Error processing binary file: ${error.message}`);
                    updateStatus('error', 'File processing failed', '0 items', '0 KB', new Date().toLocaleString());
                }
            }
            
            // Generate visualization
            function generateVisualization() {
                if (Object.keys(extractedData).length === 0) {
                    addBotMessage("Please extract data from a URL or file before generating visualizations.");
                    return;
                }
                
                const type = vizType.value;
                vizContainer.innerHTML = '';
                
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'flex items-center justify-center h-full flex-col';
                loadingDiv.innerHTML = `
                    <div class="processing-indicator w-16 mb-2"></div>
                    <p class="text-gray-500 dark:text-gray-400">Generating visualization...</p>
                `;
                vizContainer.appendChild(loadingDiv);
                
                // Simulate processing time
                setTimeout(() => {
                    vizContainer.innerHTML = '';
                    
                    switch (type) {
                        case 'dom-tree':
                            visualizeDomTree();
                            break;
                        case 'content-breakdown':
                            visualizeContentBreakdown();
                            break;
                        case 'link-graph':
                            visualizeLinkGraph();
                            break;
                        case 'word-cloud':
                            visualizeWordCloud();
                            break;
                        case 'image-gallery':
                            visualizeImageGallery();
                            break;
                    }
                    
                    addBotMessage(`📊 ${formatVizTypeName(type)} visualization generated successfully! You can see it in the Visualize tab.`);
                }, 1500);
            }
            
            // Visualize DOM tree
            function visualizeDomTree() {
                // Create a container for the tree
                vizContainer.className = 'mt-4 p-4 bg-white dark:bg-gray-800 rounded-lg h-[400px] overflow-auto custom-scrollbar';
                
                if (!extractedData.domTree || Object.keys(extractedData.domTree).length === 0) {
                    vizContainer.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">No DOM structure available for this data</p>';
                    return;
                }
                
                const treeDiv = document.createElement('div');
                treeDiv.className = 'font-mono text-sm';
                
                function renderTreeNode(node, depth = 0) {
                    const nodeDiv = document.createElement('div');
                    nodeDiv.style.paddingLeft = `${depth * 16}px`;
                    nodeDiv.className = 'leading-6 hover:bg-gray-100 dark:hover:bg-gray-700 rounded px-1';
                    
                    // Add toggle if the node has children
                    if (node.children && node.children.length > 0) {
                        const toggleSpan = document.createElement('span');
                        toggleSpan.className = 'inline-block w-4 text-gray-500 cursor-pointer';
                        toggleSpan.innerHTML = '▼';
                        toggleSpan.onclick = function(e) {
                            e.stopPropagation();
                            const childrenDiv = nodeDiv.querySelector('.children');
                            childrenDiv.classList.toggle('hidden');
                            toggleSpan.innerHTML = childrenDiv.classList.contains('hidden') ? '►' : '▼';
                        };
                        nodeDiv.appendChild(toggleSpan);
                    } else {
                        const spacerSpan = document.createElement('span');
                        spacerSpan.className = 'inline-block w-4';
                        nodeDiv.appendChild(spacerSpan);
                    }
                    
                    // Tag name
                    const tagSpan = document.createElement('span');
                    tagSpan.className = 'text-primary';
                    tagSpan.textContent = node.tag || 'text';
                    nodeDiv.appendChild(tagSpan);
                    
                    // Attributes
                    if (node.attributes && Object.keys(node.attributes).length > 0) {
                        nodeDiv.appendChild(document.createTextNode(' '));
                        
                        const attrSpan = document.createElement('span');
                        attrSpan.className = 'text-gray-500 dark:text-gray-400';
                        
                        const attrArr = [];
                        for (const [key, value] of Object.entries(node.attributes)) {
                            if (value) {
                                attrArr.push(`${key}="${value}"`);
                            } else {
                                attrArr.push(key);
                            }
                        }
                        
                        attrSpan.textContent = attrArr.join(' ');
                        nodeDiv.appendChild(attrSpan);
                    }
                    
                    // Text content preview (if exists)
                    if (node.textContent) {
                        nodeDiv.appendChild(document.createTextNode(' '));
                        
                        const textSpan = document.createElement('span');
                        textSpan.className = 'text-gray-700 dark:text-gray-300 italic';
                        
                        // Truncate long text
                        const text = node.textContent.length > 30 ? 
                            node.textContent.slice(0, 30) + '...' : 
                            node.textContent;
                            
                        textSpan.textContent = text;
                        nodeDiv.appendChild(textSpan);
                    }
                    
                    treeDiv.appendChild(nodeDiv);
                    
                    // Add children container
                    if (node.children && node.children.length > 0) {
                        const childrenDiv = document.createElement('div');
                        childrenDiv.className = 'children';
                        
                        // Append to parent nodeDiv
                        nodeDiv.appendChild(childrenDiv);
                        
                        // Render each child
                        node.children.forEach(child => {
                            renderTreeNode(child, depth + 1);
                        });
                    }
                }
                
                renderTreeNode(extractedData.domTree);
                vizContainer.appendChild(treeDiv);
            }
            
            // Visualize content breakdown
            function visualizeContentBreakdown() {
                // Set container properties
                vizContainer.className = 'mt-4 p-4 bg-white dark:bg-gray-800 rounded-lg h-[400px] overflow-auto custom-scrollbar';
                
                // Gather content type statistics
                const contentStats = {
                    'Text': extractedData.text ? extractedData.text.length : 0,
                    'Images': extractedData.images ? extractedData.images.length : 0,
                    'Links': extractedData.links ? extractedData.links.length : 0,
                    'Scripts': extractedData.scripts ? extractedData.scripts.length : 0,
                    'Styles': extractedData.styles ? extractedData.styles.length : 0,
                    'Forms': extractedData.forms ? extractedData.forms.length : 0,
                    'Media': extractedData.media ? extractedData.media.length : 0
                };
                
                // Filter out zero values
                const filteredStats = Object.fromEntries(
                    Object.entries(contentStats).filter(([_, value]) => value > 0)
                );
                
                if (Object.keys(filteredStats).length === 0) {
                    vizContainer.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">No content breakdown available for this data</p>';
                    return;
                }
                
                // Create canvas for chart
                const canvas = document.createElement('canvas');
                canvas.id = 'content-breakdown-chart';
                canvas.height = 300;
                vizContainer.appendChild(canvas);
                
                // Generate colors based on the primary color
                const baseColors = [
                    '#5D5CDE', '#7A79E8', '#9C9BF0', '#BEBEF5', '#DFDEFA',
                    '#FF8A3D', '#FFA869', '#FFC69A', '#FFE1CB'
                ];
                
                // Create the chart
                new Chart(canvas, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(filteredStats),
                        datasets: [{
                            label: 'Element Count',
                            data: Object.values(filteredStats),
                            backgroundColor: baseColors.slice(0, Object.keys(filteredStats).length),
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.raw} element${context.raw !== 1 ? 's' : ''}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    precision: 0
                                }
                            }
                        }
                    }
                });
            }
            
            // Visualize link graph
            function visualizeLinkGraph() {
                // Set container properties
                vizContainer.className = 'mt-4 p-4 bg-white dark:bg-gray-800 rounded-lg h-[400px] overflow-hidden flex flex-col';
                
                if (!extractedData.links || extractedData.links.length === 0) {
                    vizContainer.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">No links available for this data</p>';
                    return;
                }
                
                // Create summary stats
                const internalLinks = extractedData.links.filter(link => !link.isExternal).length;
                const externalLinks = extractedData.links.filter(link => link.isExternal).length;
                
                // Create summary container
                const summaryDiv = document.createElement('div');
                summaryDiv.className = 'mb-4 flex justify-around';
                
                // Internal links stat
                const internalDiv = document.createElement('div');
                internalDiv.className = 'text-center';
                internalDiv.innerHTML = `
                    <div class="text-3xl font-bold text-primary">${internalLinks}</div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">Internal Links</div>
                `;
                
                // External links stat
                const externalDiv = document.createElement('div');
                externalDiv.className = 'text-center';
                externalDiv.innerHTML = `
                    <div class="text-3xl font-bold text-accent">${externalLinks}</div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">External Links</div>
                `;
                
                // Total links stat
                const totalDiv = document.createElement('div');
                totalDiv.className = 'text-center';
                totalDiv.innerHTML = `
                    <div class="text-3xl font-bold">${internalLinks + externalLinks}</div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">Total Links</div>
                `;
                
                summaryDiv.appendChild(internalDiv);
                summaryDiv.appendChild(totalDiv);
                summaryDiv.appendChild(externalDiv);
                
                // Create chart container
                const chartContainer = document.createElement('div');
                chartContainer.className = 'flex-1';
                
                // Create canvas for chart
                const canvas = document.createElement('canvas');
                canvas.id = 'link-graph-chart';
                chartContainer.appendChild(canvas);
                
                // Append elements to container
                vizContainer.appendChild(summaryDiv);
                vizContainer.appendChild(chartContainer);
                
                // Create the chart
                new Chart(canvas, {
                    type: 'pie',
                    data: {
                        labels: ['Internal Links', 'External Links'],
                        datasets: [{
                            data: [internalLinks, externalLinks],
                            backgroundColor: ['#5D5CDE', '#FF8A3D'],
                            borderWidth: 1,
                            borderColor: '#FFFFFF'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
            
            // Visualize word cloud
            function visualizeWordCloud() {
                // Set container properties
                vizContainer.className = 'mt-4 p-4 bg-white dark:bg-gray-800 rounded-lg h-[400px] overflow-hidden';
                
                // Check if we have word frequency data
                let wordFrequency = null;
                
                if (extractedData.textAnalysis && extractedData.textAnalysis.wordFrequency) {
                    // Data from file processing
                    wordFrequency = extractedData.textAnalysis.wordFrequency;
                } else if (extractedData.text && extractedData.text.length > 0) {
                    // Extract from text content
                    const allText = extractedData.text.map(item => item.content).join(' ');
                    const analysis = analyzeText(allText);
                    wordFrequency = analysis.wordFrequency;
                }
                
                if (!wordFrequency || Object.keys(wordFrequency).length === 0) {
                    vizContainer.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">No text content available for word cloud</p>';
                    return;
                }
                
                // Create word cloud container
                const cloudContainer = document.createElement('div');
                cloudContainer.className = 'h-full flex flex-wrap justify-center items-center content-center';
                
                // Get top 50 words
                const topWords = Object.entries(wordFrequency)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 50);
                
                // Find max and min counts for scaling
                const maxCount = topWords[0][1];
                const minCount = topWords[topWords.length - 1][1];
                
                // Create word spans with size based on frequency
                topWords.forEach(([word, count]) => {
                    const wordSpan = document.createElement('span');
                    
                    // Scale font size between 14px and 48px based on frequency
                    const fontSize = 14 + ((count - minCount) / (maxCount - minCount || 1)) * 34;
                    
                    // Generate color based on frequency
                    const hue = 240; // Purple
                    const saturation = 70;
                    const lightness = 80 - ((count - minCount) / (maxCount - minCount || 1)) * 30;
                    
                    wordSpan.style.fontSize = `${fontSize}px`;
                    wordSpan.style.color = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                    wordSpan.style.margin = '0.2em';
                    wordSpan.style.fontWeight = count > (maxCount / 2) ? 'bold' : 'normal';
                    wordSpan.style.display = 'inline-block';
                    wordSpan.style.transition = 'transform 0.2s ease-in-out';
                    wordSpan.style.cursor = 'pointer';
                    wordSpan.className = 'hover:text-primary';
                    
                    wordSpan.textContent = word;
                    wordSpan.title = `${word}: ${count} occurrences`;
                    
                    // Add hover effect
                    wordSpan.addEventListener('mouseover', () => {
                        wordSpan.style.transform = 'scale(1.2)';
                    });
                    
                    wordSpan.addEventListener('mouseout', () => {
                        wordSpan.style.transform = 'scale(1)';
                    });
                    
                    cloudContainer.appendChild(wordSpan);
                });
                
                vizContainer.appendChild(cloudContainer);
            }
            
            // Visualize image gallery
            function visualizeImageGallery() {
                // Set container properties
                vizContainer.className = 'mt-4 p-4 bg-white dark:bg-gray-800 rounded-lg h-[400px] overflow-auto custom-scrollbar';
                
                if (!extractedData.images || extractedData.images.length === 0) {
                    vizContainer.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">No images available in the extracted data</p>';
                    return;
                }
                
                // Create gallery grid
                const gallery = document.createElement('div');
                gallery.className = 'grid grid-cols-2 md:grid-cols-3 gap-4';
                
                // Add each image
                extractedData.images.forEach((image, index) => {
                    const imgContainer = document.createElement('div');
                    imgContainer.className = 'image-card';
                    
                    const img = document.createElement('img');
                    img.src = image.dataUrl || `data:${image.mimeType || 'image/jpeg'};base64,${image.base64Data}`;
                    img.alt = image.alt || `Image ${index + 1}`;
                    img.className = 'w-full h-full object-cover';
                    img.loading = 'lazy';
                    
                    // Add error handler
                    img.onerror = function() {
                        img.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="%235D5CDE" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>';
                        img.alt = 'Image load error';
                    };
                    
                    imgContainer.appendChild(img);
                    gallery.appendChild(imgContainer);
                });
                
                vizContainer.appendChild(gallery);
            }
            
            // Update visualization options based on selected type
            function updateVizOptions() {
                const type = vizType.value;
                vizOptions.innerHTML = '';
                
                switch (type) {
                    case 'dom-tree':
                        vizOptions.innerHTML = `
                            <div class="grid grid-cols-2 gap-2">
                                <label class="inline-flex items-center">
                                    <input type="checkbox" id="expand-all" class="mr-2">
                                    <span class="text-sm">Expand All Nodes</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="checkbox" id="show-attributes" class="mr-2" checked>
                                    <span class="text-sm">Show Attributes</span>
                                </label>
                            </div>
                        `;
                        break;
                        
                    case 'word-cloud':
                        vizOptions.innerHTML = `
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="block text-sm">Word Count</label>
                                    <select id="word-count" class="w-full custom-input py-1 text-sm">
                                        <option value="30">Top 30</option>
                                        <option value="50" selected>Top 50</option>
                                        <option value="100">Top 100</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm">Min Word Length</label>
                                    <select id="min-word-length" class="w-full custom-input py-1 text-sm">
                                        <option value="3">3 letters</option>
                                        <option value="4" selected>4 letters</option>
                                        <option value="5">5 letters</option>
                                    </select>
                                </div>
                            </div>
                        `;
                        break;
                        
                    case 'image-gallery':
                        vizOptions.innerHTML = `
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="block text-sm">Layout</label>
                                    <select id="gallery-layout" class="w-full custom-input py-1 text-sm">
                                        <option value="grid" selected>Grid</option>
                                        <option value="masonry">Masonry</option>
                                        <option value="carousel">Carousel</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm">Image Size</label>
                                    <select id="image-size" class="w-full custom-input py-1 text-sm">
                                        <option value="small">Small</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="large">Large</option>
                                    </select>
                                </div>
                            </div>
                        `;
                        break;
                        
                    case 'content-breakdown':
                    case 'link-graph':
                        vizOptions.innerHTML = `
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="block text-sm">Chart Type</label>
                                    <select id="chart-type" class="w-full custom-input py-1 text-sm">
                                        <option value="${type === 'link-graph' ? 'pie' : 'bar'}" selected>${type === 'link-graph' ? 'Pie Chart' : 'Bar Chart'}</option>
                                        <option value="${type === 'link-graph' ? 'doughnut' : 'horizontalBar'}">${type === 'link-graph' ? 'Doughnut Chart' : 'Horizontal Bar'}</option>
                                        <option value="polar">Polar Area</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm">Color Theme</label>
                                    <select id="color-theme" class="w-full custom-input py-1 text-sm">
                                        <option value="default" selected>Default</option>
                                        <option value="pastel">Pastel</option>
                                        <option value="bright">Bright</option>
                                        <option value="monochrome">Monochrome</option>
                                    </select>
                                </div>
                            </div>
                        `;
                        break;
                }
            }
            
            // Run analysis
            function runAnalysis() {
                if (Object.keys(extractedData).length === 0) {
                    addBotMessage("Please extract data from a URL or file before running analysis.");
                    return;
                }
                
                const type = analysisType.value;
                analysisResult.innerHTML = '';
                
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'flex items-center justify-center h-full flex-col';
                loadingDiv.innerHTML = `
                    <div class="processing-indicator w-16 mb-2"></div>
                    <p class="text-gray-500 dark:text-gray-400">Running analysis...</p>
                `;
                analysisResult.appendChild(loadingDiv);
                
                // Simulate analysis time
                setTimeout(() => {
                    analysisResult.innerHTML = '';
                    
                    switch (type) {
                        case 'content-analysis':
                            contentAnalysis();
                            break;
                        case 'seo-analysis':
                            seoAnalysis();
                            break;
                        case 'sentiment-analysis':
                            sentimentAnalysis();
                            break;
                        case 'entity-extraction':
                            entityExtraction();
                            break;
                        case 'tech-stack':
                            techStackDetection();
                            break;
                    }
                    
                    addBotMessage(`🔎 ${formatAnalysisTypeName(type)} completed! You can see the results in the Analyze tab.`);
                }, 1500);
            }
            
            // Content analysis
            function contentAnalysis() {
                // Set container properties
                analysisResult.className = 'mt-4 bg-white dark:bg-gray-800 rounded-lg p-4 h-[250px] overflow-auto custom-scrollbar';
                
                let textContent = '';
                let wordCount = 0;
                let sentenceCount = 0;
                let paragraphCount = 0;
                
                // Get text content based on data source
                if (extractedData.textAnalysis) {
                    // File data
                    const analysis = extractedData.textAnalysis;
                    wordCount = analysis.wordCount || 0;
                    sentenceCount = analysis.sentenceCount || 0;
                    paragraphCount = analysis.paragraphCount || 0;
                    textContent = extractedData.content || '';
                } else if (extractedData.text && extractedData.text.length > 0) {
                    // Website data
                    textContent = extractedData.text.map(item => item.content).join(' ');
                    // Calculate stats
                    const analysis = analyzeText(textContent);
                    wordCount = analysis.wordCount;
                    sentenceCount = analysis.sentenceCount;
                    paragraphCount = analysis.paragraphCount;
                } else {
                    analysisResult.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">No text content available for analysis</p>';
                    return;
                }
                
                // Create analysis result
                const analysisDiv = document.createElement('div');
                analysisDiv.className = 'space-y-4';
                
                // Content statistics
                const statsDiv = document.createElement('div');
                statsDiv.className = 'grid grid-cols-3 gap-4';
                statsDiv.innerHTML = `
                    <div class="text-center">
                        <div class="text-2xl font-bold text-primary">${wordCount}</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Words</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-primary">${sentenceCount}</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Sentences</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-primary">${paragraphCount}</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Paragraphs</div>
                    </div>
                `;
                
                // Readability
                const readabilityScore = calculateReadabilityScore(textContent);
                const readabilityDiv = document.createElement('div');
                readabilityDiv.className = 'border-t border-gray-200 dark:border-gray-700 pt-4';
                readabilityDiv.innerHTML = `
                    <h3 class="font-medium mb-2">Readability</h3>
                    <div class="relative h-2 bg-gray-200 dark:bg-gray-700 rounded-full">
                        <div class="absolute top-0 left-0 h-full rounded-full ${getReadabilityColorClass(readabilityScore)}" style="width: ${readabilityScore}%;"></div>
                    </div>
                    <div class="flex justify-between text-xs mt-1">
                        <span>Difficult</span>
                        <span>${readabilityScore}/100</span>
                        <span>Easy</span>
                    </div>
                    <p class="text-sm mt-2">${getReadabilityDescription(readabilityScore)}</p>
                `;
                
                // Top words
                const wordFreq = extractedData.textAnalysis ? 
                    extractedData.textAnalysis.wordFrequency : 
                    analyzeText(textContent).wordFrequency;
                    
                const topWordsDiv = document.createElement('div');
                topWordsDiv.className = 'border-t border-gray-200 dark:border-gray-700 pt-4';
                topWordsDiv.innerHTML = `
                    <h3 class="font-medium mb-2">Most Common Words</h3>
                    <div class="flex flex-wrap gap-2">
                        ${getTopWordsHTML(wordFreq)}
                    </div>
                `;
                
                // Assemble full analysis
                analysisDiv.appendChild(statsDiv);
                analysisDiv.appendChild(readabilityDiv);
                analysisDiv.appendChild(topWordsDiv);
                
                analysisResult.appendChild(analysisDiv);
            }
            
            // SEO analysis
            function seoAnalysis() {
                // Set container properties
                analysisResult.className = 'mt-4 bg-white dark:bg-gray-800 rounded-lg p-4 h-[250px] overflow-auto custom-scrollbar';
                
                // Check if we have website data
                if (!extractedData.url || !extractedData.metadata) {
                    analysisResult.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">SEO analysis is only available for website data</p>';
                    return;
                }
                
                // Create analysis result
                const analysisDiv = document.createElement('div');
                analysisDiv.className = 'space-y-4';
                
                // Score calculation
                let seoScore = 0;
                const scoringFactors = [];
                
                // Check title
                const hasTitle = extractedData.metadata && extractedData.metadata.title;
                const titleLength = hasTitle ? extractedData.metadata.title.length : 0;
                const titleScore = hasTitle ? (titleLength > 10 && titleLength < 70 ? 20 : 10) : 0;
                seoScore += titleScore;
                
                scoringFactors.push({
                    name: 'Title tag',
                    score: titleScore,
                    maxScore: 20,
                    status: titleScore === 20 ? 'good' : (titleScore > 0 ? 'warning' : 'bad'),
                    message: hasTitle ? 
                        (titleLength > 10 && titleLength < 70 ? 
                            `Good title length (${titleLength} characters)` : 
                            `Title should be between 10-70 characters (currently ${titleLength})`) : 
                        'Missing page title'
                });
                
                // Check description
                const hasDescription = extractedData.metadata && extractedData.metadata.description;
                const descriptionLength = hasDescription ? extractedData.metadata.description.length : 0;
                const descriptionScore = hasDescription ? (descriptionLength > 50 && descriptionLength < 160 ? 15 : 7) : 0;
                seoScore += descriptionScore;
                
                scoringFactors.push({
                    name: 'Meta description',
                    score: descriptionScore,
                    maxScore: 15,
                    status: descriptionScore === 15 ? 'good' : (descriptionScore > 0 ? 'warning' : 'bad'),
                    message: hasDescription ? 
                        (descriptionLength > 50 && descriptionLength < 160 ? 
                            `Good description length (${descriptionLength} characters)` : 
                            `Description should be between 50-160 characters (currently ${descriptionLength})`) : 
                        'Missing meta description'
                });
                
                // Check headings
                const hasHeadings = extractedData.text && extractedData.text.some(item => /^h[1-6]$/i.test(item.tag));
                const hasH1 = extractedData.text && extractedData.text.some(item => /^h1$/i.test(item.tag));
                const headingScore = hasHeadings ? (hasH1 ? 15 : 7) : 0;
                seoScore += headingScore;
                
                scoringFactors.push({
                    name: 'Heading structure',
                    score: headingScore,
                    maxScore: 15,
                    status: headingScore === 15 ? 'good' : (headingScore > 0 ? 'warning' : 'bad'),
                    message: hasHeadings ? 
                        (hasH1 ? 'Page has proper heading structure with H1' : 'Page has headings but missing H1 tag') : 
                        'No heading tags found'
                });
                
                // Check images with alt text
                let imagesWithAlt = 0;
                let totalImages = 0;
                
                if (extractedData.images && extractedData.images.length > 0) {
                    totalImages = extractedData.images.length;
                    imagesWithAlt = extractedData.images.filter(img => img.alt && img.alt.trim().length > 0).length;
                }
                
                const imageAltScore = totalImages > 0 ? 
                    (imagesWithAlt === totalImages ? 10 : Math.floor((imagesWithAlt / totalImages) * 10)) : 
                    5; // No images is neutral
                    
                seoScore += imageAltScore;
                
                scoringFactors.push({
                    name: 'Image alt text',
                    score: imageAltScore,
                    maxScore: 10,
                    status: imageAltScore === 10 ? 'good' : (imageAltScore >= 5 ? 'warning' : 'bad'),
                    message: totalImages > 0 ? 
                        (imagesWithAlt === totalImages ? 
                            `All ${totalImages} images have alt text` : 
                            `${imagesWithAlt} of ${totalImages} images have alt text`) : 
                        'No images found on the page'
                });
                
                // Check mobile friendliness (based on viewport meta tag)
                const hasViewportMeta = extractedData.metadata && extractedData.metadata.viewport;
                const viewportScore = hasViewportMeta ? 15 : 0;
                seoScore += viewportScore;
                
                scoringFactors.push({
                    name: 'Mobile optimization',
                    score: viewportScore,
                    maxScore: 15,
                    status: viewportScore > 0 ? 'good' : 'bad',
                    message: hasViewportMeta ? 
                        'Page has viewport meta tag for mobile optimization' : 
                        'Missing viewport meta tag for mobile devices'
                });
                
                // Check canonical URL
                const hasCanonical = extractedData.metadata && extractedData.metadata.canonicalUrl;
                const canonicalScore = hasCanonical ? 10 : 0;
                seoScore += canonicalScore;
                
                scoringFactors.push({
                    name: 'Canonical URL',
                    score: canonicalScore,
                    maxScore: 10,
                    status: canonicalScore > 0 ? 'good' : 'warning',
                    message: hasCanonical ? 
                        `Page has canonical URL (${extractedData.metadata.canonicalUrl})` : 
                        'No canonical URL specified'
                });
                
                // Check social tags
                const hasSocialTags = extractedData.metadata && 
                    (extractedData.metadata.og || extractedData.metadata.twitter);
                const socialScore = hasSocialTags ? 15 : 0;
                seoScore += socialScore;
                
                scoringFactors.push({
                    name: 'Social media tags',
                    score: socialScore,
                    maxScore: 15,
                    status: socialScore > 0 ? 'good' : 'warning',
                    message: hasSocialTags ? 
                        'Page has social media meta tags' : 
                        'No social media meta tags (Open Graph, Twitter) found'
                });
                
                // Overall SEO score (max 100)
                seoScore = Math.min(100, seoScore);
                
                // Create score display
                const scoreDiv = document.createElement('div');
                scoreDiv.className = 'text-center mb-4';
                scoreDiv.innerHTML = `
                    <div class="inline-block rounded-full w-24 h-24 border-4 ${getSEOScoreClass(seoScore)} flex items-center justify-center">
                        <span class="text-3xl font-bold">${seoScore}</span>
                    </div>
                    <div class="mt-2 font-medium">${getSEOScoreLabel(seoScore)} SEO Score</div>
                `;
                
                // Create factors list
                const factorsDiv = document.createElement('div');
                factorsDiv.className = 'space-y-3';
                
                // Add each factor
                scoringFactors.forEach(factor => {
                    const factorDiv = document.createElement('div');
                    factorDiv.className = 'border-t border-gray-200 dark:border-gray-700 pt-3';
                    
                    const statusColorClass = factor.status === 'good' ? 'text-green-600 dark:text-green-400' : 
                                          (factor.status === 'warning' ? 'text-yellow-600 dark:text-yellow-400' : 
                                          'text-red-600 dark:text-red-400');
                    
                    factorDiv.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div class="font-medium">${factor.name}</div>
                            <div class="flex items-center">
                                <span class="${statusColorClass} mr-2">${factor.score}/${factor.maxScore}</span>
                                <span class="w-3 h-3 rounded-full ${factor.status === 'good' ? 'bg-green-500' : 
                                                                      (factor.status === 'warning' ? 'bg-yellow-500' : 
                                                                      'bg-red-500')}"></span>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">${factor.message}</p>
                    `;
                    
                    factorsDiv.appendChild(factorDiv);
                });
                
                // Assemble full analysis
                analysisDiv.appendChild(scoreDiv);
                analysisDiv.appendChild(factorsDiv);
                
                analysisResult.appendChild(analysisDiv);
            }
            
            // Sentiment analysis
            function sentimentAnalysis() {
                // Set container properties
                analysisResult.className = 'mt-4 bg-white dark:bg-gray-800 rounded-lg p-4 h-[250px] overflow-auto custom-scrollbar';
                
                let textContent = '';
                
                // Get text content based on data source
                if (extractedData.textAnalysis) {
                    // File data
                    textContent = extractedData.content || '';
                } else if (extractedData.text && extractedData.text.length > 0) {
                    // Website data
                    textContent = extractedData.text.map(item => item.content).join(' ');
                } else {
                    analysisResult.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">No text content available for sentiment analysis</p>';
                    return;
                }
                
                // Perform sentiment analysis
                const { sentiment, emotionalTone, subjectivity } = analyzeSentiment(textContent);
                
                // Create analysis result
                const analysisDiv = document.createElement('div');
                analysisDiv.className = 'space-y-4';
                
                // Overall sentiment gauge
                const sentimentGaugeDiv = document.createElement('div');
                sentimentGaugeDiv.className = 'text-center';
                
                const sentimentValue = sentiment.score;
                const sentimentLabel = getSentimentLabel(sentimentValue);
                const gaugeColor = getSentimentColor(sentimentValue);
                
                sentimentGaugeDiv.innerHTML = `
                    <h3 class="font-medium mb-3">Overall Sentiment</h3>
                    <div class="relative mx-auto w-64 h-4 bg-gray-200 dark:bg-gray-700 rounded-full mb-2">
                        <div class="absolute top-0 left-0 h-full ${gaugeColor} rounded-full" style="width: ${((sentimentValue + 1) / 2 * 100)}%;"></div>
                        <div class="absolute top-0 left-1/2 w-0.5 h-6 -mt-1 bg-gray-500"></div>
                    </div>
                    <div class="flex justify-between text-xs">
                        <span>Negative</span>
                        <span>Neutral</span>
                        <span>Positive</span>
                    </div>
                    <div class="mt-2 font-medium text-lg ${gaugeColor}">${sentimentLabel}</div>
                `;
                
                // Sentiment distribution
                const distributionDiv = document.createElement('div');
                distributionDiv.className = 'mt-6';
                distributionDiv.innerHTML = `
                    <h3 class="font-medium mb-3">Sentiment Distribution</h3>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-red-500">${Math.round(sentiment.negative * 100)}%</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Negative</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-gray-500">${Math.round(sentiment.neutral * 100)}%</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Neutral</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-500">${Math.round(sentiment.positive * 100)}%</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Positive</div>
                        </div>
                    </div>
                `;
                
                // Emotional tone
                const emotionalToneDiv = document.createElement('div');
                emotionalToneDiv.className = 'mt-6 border-t border-gray-200 dark:border-gray-700 pt-4';
                
                // Convert emotional tone to bars
                let emotionalToneHTML = '';
                for (const [emotion, value] of Object.entries(emotionalTone)) {
                    const percentage = Math.round(value * 100);
                    const emotionColor = getEmotionColor(emotion);
                    
                    emotionalToneHTML += `
                        <div class="mb-2">
                            <div class="flex justify-between mb-1">
                                <span class="text-sm capitalize">${emotion}</span>
                                <span class="text-sm">${percentage}%</span>
                            </div>
                            <div class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full">
                                <div class="h-full ${emotionColor} rounded-full" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    `;
                }
                
                emotionalToneDiv.innerHTML = `
                    <h3 class="font-medium mb-3">Emotional Tone</h3>
                    ${emotionalToneHTML}
                `;
                
                // Subjectivity
                const subjectivityDiv = document.createElement('div');
                subjectivityDiv.className = 'mt-6 border-t border-gray-200 dark:border-gray-700 pt-4';
                
                subjectivityDiv.innerHTML = `
                    <h3 class="font-medium mb-3">Subjectivity Analysis</h3>
                    <div class="relative mx-auto w-full h-4 bg-gray-200 dark:bg-gray-700 rounded-full mb-2">
                        <div class="absolute top-0 left-0 h-full bg-blue-500 rounded-full" style="width: ${subjectivity * 100}%;"></div>
                    </div>
                    <div class="flex justify-between text-xs">
                        <span>Objective</span>
                        <span>Mixed</span>
                        <span>Subjective</span>
                    </div>
                    <p class="text-sm mt-2">${getSubjectivityDescription(subjectivity)}</p>
                `;
                
                // Assemble full analysis
                analysisDiv.appendChild(sentimentGaugeDiv);
                analysisDiv.appendChild(distributionDiv);
                analysisDiv.appendChild(emotionalToneDiv);
                analysisDiv.appendChild(subjectivityDiv);
                
                analysisResult.appendChild(analysisDiv);
            }
            
            // Entity extraction
            function entityExtraction() {
                // Set container properties
                analysisResult.className = 'mt-4 bg-white dark:bg-gray-800 rounded-lg p-4 h-[250px] overflow-auto custom-scrollbar';
                
                let textContent = '';
                
                // Get text content based on data source
                if (extractedData.textAnalysis) {
                    // File data
                    textContent = extractedData.content || '';
                } else if (extractedData.text && extractedData.text.length > 0) {
                    // Website data
                    textContent = extractedData.text.map(item => item.content).join(' ');
                } else {
                    analysisResult.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">No text content available for entity extraction</p>';
                    return;
                }
                
                // Extract entities (simulated for demo)
                const entities = extractEntities(textContent);
                
                // Create analysis result
                const analysisDiv = document.createElement('div');
                analysisDiv.className = 'space-y-4';
                
                // Summary of found entities
                const summaryDiv = document.createElement('div');
                summaryDiv.className = 'text-center mb-4';
                
                const totalEntities = Object.values(entities).reduce((sum, arr) => sum + arr.length, 0);
                
                summaryDiv.innerHTML = `
                    <div class="text-2xl font-bold text-primary">${totalEntities}</div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">Entities Found</div>
                `;
                
                // Create entity type sections
                const entityTypesDiv = document.createElement('div');
                entityTypesDiv.className = 'space-y-4';
                
                // Entity type colors
                const typeColors = {
                    people: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300',
                    organizations: 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300',
                    locations: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300',
                    dates: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300',
                    other: 'bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300'
                };
                
                // Create a section for each entity type
                for (const [type, items] of Object.entries(entities)) {
                    if (items.length === 0) continue;
                    
                    const typeDiv = document.createElement('div');
                    const typeName = type.charAt(0).toUpperCase() + type.slice(1);
                    
                    typeDiv.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-medium">${typeName}</h3>
                            <span class="text-sm text-gray-600 dark:text-gray-400">${items.length} found</span>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            ${items.map(item => `<span class="px-2 py-1 rounded-full text-sm ${typeColors[type]}">${item}</span>`).join('')}
                        </div>
                    `;
                    
                    entityTypesDiv.appendChild(typeDiv);
                    
                    // Add separator if not the last section
                    if (Object.entries(entities).findIndex(([t]) => t === type) < Object.entries(entities).length - 1) {
                        const separator = document.createElement('div');
                        separator.className = 'border-t border-gray-200 dark:border-gray-700';
                        entityTypesDiv.appendChild(separator);
                    }
                }
                
                // Assemble full analysis
                analysisDiv.appendChild(summaryDiv);
                analysisDiv.appendChild(entityTypesDiv);
                
                analysisResult.appendChild(analysisDiv);
            }
            
            // Tech stack detection
            function techStackDetection() {
                // Set container properties
                analysisResult.className = 'mt-4 bg-white dark:bg-gray-800 rounded-lg p-4 h-[250px] overflow-auto custom-scrollbar';
                
                // Check if we have website data
                if (!extractedData.url) {
                    analysisResult.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">Tech stack detection is only available for website data</p>';
                    return;
                }
                
                // Detect tech stack (simulated for demo)
                const techStack = detectTechStack(extractedData);
                
                // Create analysis result
                const analysisDiv = document.createElement('div');
                analysisDiv.className = 'space-y-4';
                
                // Create tech categories
                const categoryOrder = ['frontend', 'backend', 'framework', 'analytics', 'marketing', 'server', 'other'];
                
                for (const category of categoryOrder) {
                    if (!techStack[category] || techStack[category].length === 0) continue;
                    
                    const categoryDiv = document.createElement('div');
                    const categoryName = getCategoryDisplayName(category);
                    
                    categoryDiv.innerHTML = `
                        <h3 class="font-medium mb-2">${categoryName}</h3>
                        <div class="grid grid-cols-2 gap-2">
                            ${techStack[category].map(tech => `
                                <div class="flex items-center p-2 bg-gray-100 dark:bg-gray-700 rounded">
                                    <div class="w-6 h-6 mr-2 flex-shrink-0 flex items-center justify-center bg-white dark:bg-gray-800 rounded">
                                        ${getTechIcon(tech.name)}
                                    </div>
                                    <div>
                                        <div class="font-medium text-sm">${tech.name}</div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400">${tech.version || 'Unknown Version'}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    
                    analysisDiv.appendChild(categoryDiv);
                    
                    // Add separator
                    const separator = document.createElement('div');
                    separator.className = 'border-t border-gray-200 dark:border-gray-700 my-3';
                    analysisDiv.appendChild(separator);
                }
                
                analysisResult.appendChild(analysisDiv);
            }
            
            // Update export options based on format
            function updateExportOptions() {
                const format = exportFormat.value;
                
                // Clear previous options
                document.getElementById('export-options').innerHTML = '';
                
                switch (format) {
                    case 'json':
                        document.getElementById('export-options').innerHTML = `
                            <div class="mb-4">
                                <label class="inline-flex items-center mb-2">
                                    <input type="checkbox" id="pretty-json" class="mr-2" checked>
                                    <span class="text-sm">Pretty Print</span>
                                </label>
                                <label class="block mb-2 text-sm font-medium">Data to Export</label>
                                <select id="json-export-data" class="w-full custom-input">
                                    <option value="all">All Data</option>
                                    <option value="text">Text Only</option>
                                    <option value="links">Links Only</option>
                                    <option value="images">Images Only</option>
                                    <option value="metadata">Metadata Only</option>
                                </select>
                            </div>
                        `;
                        break;
                    case 'csv':
                        document.getElementById('export-options').innerHTML = `
                            <div class="mb-4">
                                <label class="block mb-2 text-sm font-medium">Data to Export</label>
                                <select id="csv-export-data" class="w-full custom-input">
                                    <option value="text">Text Content</option>
                                    <option value="links">Links</option>
                                    <option value="images">Images</option>
                                </select>
                            </div>
                            <label class="inline-flex items-center mb-2">
                                <input type="checkbox" id="include-headers" class="mr-2" checked>
                                <span class="text-sm">Include Headers</span>
                            </label>
                        `;
                        break;
                    case 'html':
                        document.getElementById('export-options').innerHTML = `
                            <div class="mb-4">
                                <label class="block mb-2 text-sm font-medium">Export Format</label>
                                <select id="html-export-format" class="w-full custom-input">
                                    <option value="report">Formatted Report</option>
                                    <option value="table">Data Table</option>
                                    <option value="gallery">Image Gallery</option>
                                </select>
                            </div>
                            <label class="inline-flex items-center mb-2">
                                <input type="checkbox" id="include-styles" class="mr-2" checked>
                                <span class="text-sm">Include CSS Styles</span>
                            </label>
                        `;
                        break;
                    case 'md':
                        document.getElementById('export-options').innerHTML = `
                            <div class="mb-4">
                                <label class="block mb-2 text-sm font-medium">Export Format</label>
                                <select id="md-export-format" class="w-full custom-input">
                                    <option value="report">Full Report</option>
                                    <option value="summary">Brief Summary</option>
                                </select>
                            </div>
                            <label class="inline-flex items-center mb-2">
                                <input type="checkbox" id="include-frontmatter" class="mr-2" checked>
                                <span class="text-sm">Include YAML Frontmatter</span>
                            </label>
                        `;
                        break;
                    case 'qr':
                        document.getElementById('export-options').innerHTML = `
                            <div class="mb-4">
                                <label class="block mb-2 text-sm font-medium">QR Content</label>
                                <select id="qr-export-content" class="w-full custom-input">
                                    <option value="url">Original URL</option>
                                    <option value="summary">Data Summary</option>
                                    <option value="json">JSON Data (Truncated)</option>
                                </select>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block mb-2 text-sm font-medium">Size</label>
                                    <select id="qr-size" class="w-full custom-input">
                                        <option value="128">Small (128px)</option>
                                        <option value="256" selected>Medium (256px)</option>
                                        <option value="512">Large (512px)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block mb-2 text-sm font-medium">Error Correction</label>
                                    <select id="qr-error-correction" class="w-full custom-input">
                                        <option value="L">Low (7%)</option>
                                        <option value="M" selected>Medium (15%)</option>
                                        <option value="Q">High (25%)</option>
                                        <option value="H">Highest (30%)</option>
                                    </select>
                                </div>
                            </div>
                        `;
                        break;
                }
            }
            
            // Generate export
            function generateExport() {
                if (Object.keys(extractedData).length === 0) {
                    addBotMessage("Please extract data from a URL or file before generating exports.");
                    return;
                }
                
                const format = exportFormat.value;
                exportResult.innerHTML = '';
                
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'flex items-center justify-center h-full flex-col';
                loadingDiv.innerHTML = `
                    <div class="processing-indicator w-16 mb-2"></div>
                    <p class="text-gray-500 dark:text-gray-400">Generating export...</p>
                `;
                exportResult.appendChild(loadingDiv);
                
                // Simulate processing time
                setTimeout(() => {
                    exportResult.innerHTML = '';
                    
                    let exportContent = '';
                    
                    switch (format) {
                        case 'json':
                            exportContent = exportJSON();
                            displayCodeExport(exportContent, 'json');
                            break;
                        case 'csv':
                            exportContent = exportCSV();
                            displayCodeExport(exportContent, 'csv');
                            break;
                        case 'html':
                            exportContent = exportHTML();
                            displayCodeExport(exportContent, 'html');
                            break;
                        case 'md':
                            exportContent = exportMarkdown();
                            displayCodeExport(exportContent, 'markdown');
                            break;
                        case 'qr':
                            exportQRCode();
                            break;
                    }
                    
                    if (format !== 'qr') {
                        addBotMessage(`📤 Export generated in ${format.toUpperCase()} format. You can view and copy it in the Export tab.`);
                    }
                }, 1000);
            }
            
            // Export as JSON
            function exportJSON() {
                const isPretty = document.getElementById('pretty-json').checked;
                const dataType = document.getElementById('json-export-data').value;
                
                let exportData = {};
                
                switch (dataType) {
                    case 'all':
                        exportData = extractedData;
                        break;
                    case 'text':
                        exportData = {
                            source: extractedData.source,
                            url: extractedData.url,
                            timestamp: extractedData.timestamp,
                            text: extractedData.text || []
                        };
                        break;
                    case 'links':
                        exportData = {
                            source: extractedData.source,
                            url: extractedData.url,
                            timestamp: extractedData.timestamp,
                            links: extractedData.links || []
                        };
                        break;
                    case 'images':
                        exportData = {
                            source: extractedData.source,
                            url: extractedData.url,
                            timestamp: extractedData.timestamp,
                            images: extractedData.images || []
                        };
                        break;
                    case 'metadata':
                        exportData = {
                            source: extractedData.source,
                            url: extractedData.url,
                            timestamp: extractedData.timestamp,
                            metadata: extractedData.metadata || {}
                        };
                        break;
                }
                
                return JSON.stringify(exportData, null, isPretty ? 2 : 0);
            }
            
            // Export as CSV
            function exportCSV() {
                const dataType = document.getElementById('csv-export-data').value;
                const includeHeaders = document.getElementById('include-headers').checked;
                
                let csvContent = '';
                
                switch (dataType) {
                    case 'text':
                        if (includeHeaders) {
                            csvContent = 'Tag,Content,Position\n';
                        }
                        
                        if (extractedData.text && extractedData.text.length > 0) {
                            extractedData.text.forEach((item, index) => {
                                const tag = item.tag || 'text';
                                const content = `"${item.content.replace(/"/g, '""')}"`;
                                csvContent += `${tag},${content},${index}\n`;
                            });
                        }
                        break;
                        
                    case 'links':
                        if (includeHeaders) {
                            csvContent = 'URL,Text,Type,NoFollow\n';
                        }
                        
                        if (extractedData.links && extractedData.links.length > 0) {
                            extractedData.links.forEach(link => {
                                const url = `"${link.url.replace(/"/g, '""')}"`;
                                const text = `"${(link.text || '').replace(/"/g, '""')}"`;
                                const type = link.isExternal ? 'external' : 'internal';
                                const noFollow = link.attributes && link.attributes.rel && link.attributes.rel.includes('nofollow') ? 'true' : 'false';
                                
                                csvContent += `${url},${text},${type},${noFollow}\n`;
                            });
                        }
                        break;
                        
                    case 'images':
                        if (includeHeaders) {
                            csvContent = 'URL,Alt Text,Width,Height\n';
                        }
                        
                        if (extractedData.images && extractedData.images.length > 0) {
                            extractedData.images.forEach(img => {
                                const url = `"${img.url ? img.url.replace(/"/g, '""') : ''}"`;
                                const alt = `"${(img.alt || '').replace(/"/g, '""')}"`;
                                const width = img.width || '';
                                const height = img.height || '';
                                
                                csvContent += `${url},${alt},${width},${height}\n`;
                            });
                        }
                        break;
                }
                
                return csvContent;
            }
            
            // Export as HTML
            function exportHTML() {
                const format = document.getElementById('html-export-format').value;
                const includeStyles = document.getElementById('include-styles').checked;
                
                let htmlContent = '<!DOCTYPE html>\n<html lang="en">\n<head>\n';
                htmlContent += '  <meta charset="UTF-8">\n';
                htmlContent += '  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n';
                htmlContent += `  <title>Export from ${extractedData.url || extractedData.filename || 'WebScraper Pro'}</title>\n`;
                
                if (includeStyles) {
                    htmlContent += '  <style>\n';
                    htmlContent += '    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 1200px; margin: 0 auto; padding: 20px; }\n';
                    htmlContent += '    h1 { color: #5D5CDE; }\n';
                    htmlContent += '    table { border-collapse: collapse; width: 100%; }\n';
                    htmlContent += '    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n';
                    htmlContent += '    th { background-color: #f2f2f2; }\n';
                    htmlContent += '    tr:nth-child(even) { background-color: #f9f9f9; }\n';
                    htmlContent += '    .metadata { background-color: #f5f5f5; padding: 15px; border-radius: 4px; margin-bottom: 20px; }\n';
                    htmlContent += '    .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }\n';
                    htmlContent += '    .gallery-item { border: 1px solid #ddd; border-radius: 4px; overflow: hidden; }\n';
                    htmlContent += '    .gallery-item img { width: 100%; height: auto; display: block; }\n';
                    htmlContent += '    .gallery-caption { padding: 8px; font-size: 14px; }\n';
                    htmlContent += '  </style>\n';
                }
                
                htmlContent += '</head>\n<body>\n';
                
                // Add header
                htmlContent += `  <h1>Export from ${extractedData.url || extractedData.filename || 'WebScraper Pro'}</h1>\n`;
                htmlContent += `  <p>Generated on ${new Date().toLocaleString()}</p>\n\n`;
                
                switch (format) {
                    case 'report':
                        // Add metadata section
                        if (extractedData.metadata && Object.keys(extractedData.metadata).length > 0) {
                            htmlContent += '  <h2>Metadata</h2>\n';
                            htmlContent += '  <div class="metadata">\n';
                            
                            for (const [key, value] of Object.entries(extractedData.metadata)) {
                                if (value && typeof value !== 'object') {
                                    htmlContent += `    <p><strong>${key}:</strong> ${value}</p>\n`;
                                }
                            }
                            
                            htmlContent += '  </div>\n\n';
                        }
                        
                        // Add text content
                        if (extractedData.text && extractedData.text.length > 0) {
                            htmlContent += '  <h2>Text Content</h2>\n';
                            
                            extractedData.text.slice(0, 50).forEach(item => {
                                const tag = item.tag || 'p';
                                htmlContent += `  <${tag}>${item.content}</${tag}>\n`;
                            });
                            
                            if (extractedData.text.length > 50) {
                                htmlContent += `  <p><em>Showing 50 of ${extractedData.text.length} text elements</em></p>\n\n`;
                            }
                        } else if (extractedData.content) {
                            htmlContent += '  <h2>Content</h2>\n';
                            htmlContent += `  <pre>${extractedData.content.slice(0, 1000)}${extractedData.content.length > 1000 ? '...' : ''}</pre>\n\n`;
                        }
                        
                        // Add links section
                        if (extractedData.links && extractedData.links.length > 0) {
                            htmlContent += '  <h2>Links</h2>\n';
                            htmlContent += '  <ul>\n';
                            
                            extractedData.links.slice(0, 30).forEach(link => {
                                htmlContent += `    <li><a href="${link.url}">${link.text || link.url}</a> (${link.isExternal ? 'External' : 'Internal'})</li>\n`;
                            });
                            
                            htmlContent += '  </ul>\n';
                            
                            if (extractedData.links.length > 30) {
                                htmlContent += `  <p><em>Showing 30 of ${extractedData.links.length} links</em></p>\n\n`;
                            }
                        }
                        
                        // Add images section
                        if (extractedData.images && extractedData.images.length > 0) {
                            htmlContent += '  <h2>Images</h2>\n';
                            htmlContent += '  <div class="gallery">\n';
                            
                            extractedData.images.slice(0, 12).forEach(img => {
                                htmlContent += '    <div class="gallery-item">\n';
                                
                                // Use data URL if available, otherwise use URL
                                const imgSrc = img.dataUrl || (img.base64Data ? `data:${img.mimeType || 'image/jpeg'};base64,${img.base64Data}` : img.url);
                                
                                htmlContent += `      <img src="${imgSrc}" alt="${img.alt || ''}" loading="lazy">\n`;
                                htmlContent += `      <div class="gallery-caption">${img.alt || 'Image'}</div>\n`;
                                htmlContent += '    </div>\n';
                            });
                            
                            htmlContent += '  </div>\n';
                            
                            if (extractedData.images.length > 12) {
                                htmlContent += `  <p><em>Showing 12 of ${extractedData.images.length} images</em></p>\n\n`;
                            }
                        }
                        break;
                        
                    case 'table':
                        // Determine what data we can display in tabular format
                        if (extractedData.text && extractedData.text.length > 0) {
                            htmlContent += '  <h2>Text Content</h2>\n';
                            htmlContent += '  <table>\n';
                            htmlContent += '    <thead>\n';
                            htmlContent += '      <tr><th>Tag</th><th>Content</th></tr>\n';
                            htmlContent += '    </thead>\n';
                            htmlContent += '    <tbody>\n';
                            
                            extractedData.text.slice(0, 100).forEach(item => {
                                htmlContent += '      <tr>\n';
                                htmlContent += `        <td>${item.tag || 'text'}</td>\n`;
                                htmlContent += `        <td>${item.content}</td>\n`;
                                htmlContent += '      </tr>\n';
                            });
                            
                            htmlContent += '    </tbody>\n';
                            htmlContent += '  </table>\n';
                            
                            if (extractedData.text.length > 100) {
                                htmlContent += `  <p><em>Showing 100 of ${extractedData.text.length} text elements</em></p>\n\n`;
                            }
                        }
                        
                        if (extractedData.links && extractedData.links.length > 0) {
                            htmlContent += '  <h2>Links</h2>\n';
                            htmlContent += '  <table>\n';
                            htmlContent += '    <thead>\n';
                            htmlContent += '      <tr><th>URL</th><th>Text</th><th>Type</th></tr>\n';
                            htmlContent += '    </thead>\n';
                            htmlContent += '    <tbody>\n';
                            
                            extractedData.links.slice(0, 100).forEach(link => {
                                htmlContent += '      <tr>\n';
                                htmlContent += `        <td><a href="${link.url}">${link.url}</a></td>\n`;
                                htmlContent += `        <td>${link.text || ''}</td>\n`;
                                htmlContent += `        <td>${link.isExternal ? 'External' : 'Internal'}</td>\n`;
                                htmlContent += '      </tr>\n';
                            });
                            
                            htmlContent += '    </tbody>\n';
                            htmlContent += '  </table>\n';
                            
                            if (extractedData.links.length > 100) {
                                htmlContent += `  <p><em>Showing 100 of ${extractedData.links.length} links</em></p>\n\n`;
                            }
                        }
                        break;
                        
                    case 'gallery':
                        // Images gallery
                        if (extractedData.images && extractedData.images.length > 0) {
                            htmlContent += '  <h2>Image Gallery</h2>\n';
                            htmlContent += '  <div class="gallery">\n';
                            
                            extractedData.images.forEach(img => {
                                htmlContent += '    <div class="gallery-item">\n';
                                
                                // Use data URL if available, otherwise use URL
                                const imgSrc = img.dataUrl || (img.base64Data ? `data:${img.mimeType || 'image/jpeg'};base64,${img.base64Data}` : img.url);
                                
                                htmlContent += `      <img src="${imgSrc}" alt="${img.alt || ''}" loading="lazy">\n`;
                                htmlContent += `      <div class="gallery-caption">${img.alt || 'Image'}</div>\n`;
                                htmlContent += '    </div>\n';
                            });
                            
                            htmlContent += '  </div>\n';
                        } else {
                            htmlContent += '  <p>No images found in the extracted data.</p>\n';
                        }
                        break;
                }
                
                htmlContent += '</body>\n</html>';
                
                return htmlContent;
            }
            
            // Export as Markdown
            function exportMarkdown() {
                const format = document.getElementById('md-export-format').value;
                const includeFrontmatter = document.getElementById('include-frontmatter').checked;
                
                let mdContent = '';
                
                // Add frontmatter
                if (includeFrontmatter) {
                    mdContent += '---\n';
                    mdContent += `title: ${extractedData.metadata?.title || extractedData.url || extractedData.filename || 'WebScraper Pro Export'}\n`;
                    mdContent += `date: ${new Date().toISOString()}\n`;
                    mdContent += `source: ${extractedData.url || extractedData.filename || 'Unknown'}\n`;
                    
                    if (extractedData.metadata) {
                        if (extractedData.metadata.description) {
                            mdContent += `description: "${extractedData.metadata.description}"\n`;
                        }
                        if (extractedData.metadata.author) {
                            mdContent += `author: ${extractedData.metadata.author}\n`;
                        }
                        if (extractedData.metadata.keywords) {
                            const keywords = Array.isArray(extractedData.metadata.keywords) ? 
                                extractedData.metadata.keywords.join(', ') : 
                                extractedData.metadata.keywords;
                            mdContent += `keywords: [${keywords}]\n`;
                        }
                    }
                    
                    mdContent += '---\n\n';
                }
                
                // Add title
                mdContent += `# ${extractedData.metadata?.title || extractedData.url || extractedData.filename || 'WebScraper Pro Export'}\n\n`;
                
                switch (format) {
                    case 'report':
                        // Add metadata section
                        if (extractedData.metadata && Object.keys(extractedData.metadata).length > 0) {
                            mdContent += '## Metadata\n\n';
                            
                            for (const [key, value] of Object.entries(extractedData.metadata)) {
                                if (value && typeof value !== 'object') {
                                    mdContent += `**${key}:** ${value}\n\n`;
                                }
                            }
                        }
                        
                        // Add text content
                        if (extractedData.text && extractedData.text.length > 0) {
                            mdContent += '## Text Content\n\n';
                            
                            extractedData.text.slice(0, 50).forEach(item => {
                                if (item.tag && /^h[1-6]$/.test(item.tag)) {
                                    const level = parseInt(item.tag.substring(1)) + 1;
                                    const heading = '#'.repeat(Math.min(level, 6));
                                    mdContent += `${heading} ${item.content}\n\n`;
                                } else {
                                    mdContent += `${item.content}\n\n`;
                                }
                            });
                            
                            if (extractedData.text.length > 50) {
                                mdContent += `*Showing 50 of ${extractedData.text.length} text elements*\n\n`;
                            }
                        } else if (extractedData.content) {
                            mdContent += '## Content\n\n';
                            mdContent += '```\n';
                            mdContent += extractedData.content.slice(0, 1000);
                            if (extractedData.content.length > 1000) {
                                mdContent += '...\n';
                            }
                            mdContent += '```\n\n';
                        }
                        
                        // Add links section
                        if (extractedData.links && extractedData.links.length > 0) {
                            mdContent += '## Links\n\n';
                            
                            extractedData.links.slice(0, 30).forEach(link => {
                                mdContent += `- [${link.text || link.url}](${link.url}) ${link.isExternal ? '(External)' : '(Internal)'}\n`;
                            });
                            
                            mdContent += '\n';
                            
                            if (extractedData.links.length > 30) {
                                mdContent += `*Showing 30 of ${extractedData.links.length} links*\n\n`;
                            }
                        }
                        
                        // Add images section - note that since this is Markdown,
                        // we can't embed base64 images directly, so we'll just provide links or alt text
                        if (extractedData.images && extractedData.images.length > 0) {
                            mdContent += '## Images\n\n';
                            
                            extractedData.images.slice(0, 15).forEach(img => {
                                if (img.url) {
                                    mdContent += `![${img.alt || 'Image'}](${img.url})\n\n`;
                                } else {
                                    mdContent += `*Image: ${img.alt || 'No description available'}*\n\n`;
                                }
                            });
                            
                            if (extractedData.images.length > 15) {
                                mdContent += `*Showing 15 of ${extractedData.images.length} images*\n\n`;
                            }
                        }
                        break;
                        
                    case 'summary':
                        // Just provide a brief summary
                        mdContent += '## Summary\n\n';
                        
                        if (extractedData.url) {
                            mdContent += `Source URL: ${extractedData.url}\n\n`;
                        } else if (extractedData.filename) {
                            mdContent += `Source file: ${extractedData.filename}\n\n`;
                        }
                        
                        if (extractedData.metadata && extractedData.metadata.description) {
                            mdContent += `${extractedData.metadata.description}\n\n`;
                        }
                        
                        // Add statistics
                        mdContent += '### Content Statistics\n\n';
                        
                        if (extractedData.text) {
                            mdContent += `- **Text elements**: ${extractedData.text.length}\n`;
                        }
                        
                        if (extractedData.links) {
                            const internalLinks = extractedData.links.filter(l => !l.isExternal).length;
                            const externalLinks = extractedData.links.filter(l => l.isExternal).length;
                            mdContent += `- **Links**: ${extractedData.links.length} (${internalLinks} internal, ${externalLinks} external)\n`;
                        }
                        
                        if (extractedData.images) {
                            mdContent += `- **Images**: ${extractedData.images.length}\n`;
                        }
                        
                        if (extractedData.textAnalysis) {
                            mdContent += `- **Words**: ${extractedData.textAnalysis.wordCount}\n`;
                            mdContent += `- **Sentences**: ${extractedData.textAnalysis.sentenceCount}\n`;
                            mdContent += `- **Paragraphs**: ${extractedData.textAnalysis.paragraphCount}\n`;
                        }
                        
                        mdContent += '\n';
                        break;
                }
                
                // Add footer
                mdContent += '---\n\n';
                mdContent += `Generated by WebScraper Pro on ${new Date().toLocaleString()}\n`;
                
                return mdContent;
            }
            
            // Export as QR Code
            function exportQRCode() {
                const contentType = document.getElementById('qr-export-content').value;
                const size = parseInt(document.getElementById('qr-size').value);
                const errorCorrection = document.getElementById('qr-error-correction').value;
                
                // Determine content for QR code
                let content = '';
                
                switch (contentType) {
                    case 'url':
                        content = extractedData.url || '';
                        break;
                    case 'summary':
                        // Create a brief summary text
                        if (extractedData.url) {
                            content = `URL: ${extractedData.url}\n`;
                        } else if (extractedData.filename) {
                            content = `File: ${extractedData.filename}\n`;
                        }
                        
                        if (extractedData.metadata && extractedData.metadata.title) {
                            content += `Title: ${extractedData.metadata.title}\n`;
                        }
                        
                        content += `Extracted on: ${new Date().toLocaleString()}\n`;
                        break;
                    case 'json':
                        // Create a minimal JSON representation
                        const minData = {
                            source: extractedData.source,
                            url: extractedData.url,
                            timestamp: extractedData.timestamp
                        };
                        
                        if (extractedData.metadata && extractedData.metadata.title) {
                            minData.title = extractedData.metadata.title;
                        }
                        
                        content = JSON.stringify(minData);
                        break;
                }
                
                if (!content) {
                    exportResult.innerHTML = '<p class="text-center text-red-500">No content available for QR code generation</p>';
                    return;
                }
                
                // Clear previous content
                exportResult.innerHTML = '';
                
                // Create container for QR code
                const qrContainer = document.createElement('div');
                qrContainer.className = 'flex flex-col items-center justify-center h-full';
                
                // Generate QR code
                try {
                    QRCode.toCanvas(content, { 
                        width: size,
                        margin: 4,
                        errorCorrectionLevel: errorCorrection
                    }, function(error, canvas) {
                        if (error) {
                            exportResult.innerHTML = `<p class="text-center text-red-500">Error generating QR code: ${error.message}</p>`;
                        } else {
                            canvas.className = 'max-w-full max-h-full';
                            qrContainer.appendChild(canvas);
                            
                            // Add download hint
                            const hintText = document.createElement('p');
                            hintText.className = 'text-sm text-gray-600 dark:text-gray-400 mt-2';
                            hintText.textContent = 'Right-click and select "Save image as..." to download';
                            qrContainer.appendChild(hintText);
                            
                            // Add content hint
                            const contentText = document.createElement('p');
                            contentText.className = 'text-xs text-gray-500 dark:text-gray-400 mt-1';
                            contentText.textContent = `Content: ${content.length > 30 ? content.substring(0, 30) + '...' : content}`;
                            qrContainer.appendChild(contentText);
                        }
                    });
                    
                    exportResult.appendChild(qrContainer);
                    
                    // Add success message in chat
                    addBotMessage(`📱 QR code generated successfully! You can view it in the Export tab and right-click to save the image.`);
                    
                } catch (error) {
                    exportResult.innerHTML = `<p class="text-center text-red-500">Failed to generate QR code: ${error.message}</p>`;
                    addBotMessage(`⚠️ Error generating QR code: ${error.message}`);
                }
            }
            
            // Copy export to clipboard
            function copyExport() {
                const format = exportFormat.value;
                
                // Skip QR code format
                if (format === 'qr') {
                    addBotMessage("To save the QR code, right-click on the image and select 'Save image as...'");
                    return;
                }
                
                // Get export content
                let exportContent = '';
                
                switch (format) {
                    case 'json':
                        exportContent = exportJSON();
                        break;
                    case 'csv':
                        exportContent = exportCSV();
                        break;
                    case 'html':
                        exportContent = exportHTML();
                        break;
                    case 'md':
                        exportContent = exportMarkdown();
                        break;
                }
                
                // Copy to clipboard
                try {
                    navigator.clipboard.writeText(exportContent).then(() => {
                        addBotMessage(`✅ ${format.toUpperCase()} content copied to clipboard!`);
                    }).catch(err => {
                        addBotMessage(`❌ Clipboard error: ${err.message}. Please select and copy the content manually.`);
                    });
                } catch (error) {
                    addBotMessage(`❌ Clipboard operation not supported. Please select and copy the content manually.`);
                }
            }
            
            // Display code in export result
            function displayCodeExport(content, language) {
                // Create container
                const pre = document.createElement('pre');
                pre.className = 'hljs language-' + language;
                
                // Create code element
                const code = document.createElement('code');
                code.className = 'language-' + language;
                code.textContent = content;
                
                // Apply syntax highlighting
                if (language && hljs) {
                    hljs.highlightElement(code);
                }
                
                pre.appendChild(code);
                exportResult.appendChild(pre);
            }
            
            // Update gallery with extracted images
            function updateGallery() {
                galleryContent.innerHTML = '';
                
                if (!extractedData.images || extractedData.images.length === 0) {
                    galleryContent.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">No images available</p>';
                    return;
                }
                
                // Create image grid
                extractedData.images.forEach((image, index) => {
                    const imgContainer = document.createElement('div');
                    imgContainer.className = 'image-card';
                    
                    const img = document.createElement('img');
                    img.src = image.dataUrl || (image.base64Data ? `data:${image.mimeType || 'image/jpeg'};base64,${image.base64Data}` : image.url);
                    img.alt = image.alt || `Image ${index + 1}`;
                    img.loading = 'lazy';
                    
                    // Add error handler
                    img.onerror = function() {
                        img.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="%235D5CDE" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>';
                        img.alt = 'Image load error';
                    };
                    
                    imgContainer.appendChild(img);
                    galleryContent.appendChild(imgContainer);
                });
            }
            
            // Update results view
            function updateResultsView() {
                const mode = viewMode.value;
                
                if (Object.keys(extractedData).length === 0) {
                    resultsContent.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">No data has been extracted yet</p>';
                    return;
                }
                
                resultsContent.innerHTML = '';
                
                switch (mode) {
                    case 'raw':
                        const pre = document.createElement('pre');
                        pre.className = 'text-sm font-mono';
                        pre.textContent = JSON.stringify(extractedData, null, 2);
                        resultsContent.appendChild(pre);
                        break;
                        
                    case 'pretty':
                        const prettyPre = document.createElement('pre');
                        prettyPre.className = 'hljs language-json';
                        
                        const code = document.createElement('code');
                        code.className = 'language-json';
                        code.textContent = JSON.stringify(extractedData, null, 2);
                        
                        // Apply syntax highlighting if available
                        if (hljs) {
                            hljs.highlightElement(code);
                        }
                        
                        prettyPre.appendChild(code);
                        resultsContent.appendChild(prettyPre);
                        break;
                        
                    case 'tree':
                        createInteractiveJsonTree(extractedData, resultsContent);
                        break;
                        
                    case 'summary':
                        createDataSummary(extractedData, resultsContent);
                        break;
                }
            }
            
            // Create interactive JSON tree
            function createInteractiveJsonTree(data, container) {
                container.className = 'bg-white dark:bg-gray-800 p-4 rounded-lg json-viewer custom-scrollbar';
                
                // Function to create nodes recursively
                function createNode(key, value, isRoot = false) {
                    const nodeDiv = document.createElement('div');
                    nodeDiv.className = isRoot ? '' : 'json-item';
                    
                    const isExpandable = value !== null && typeof value === 'object';
                    
                    // Add key name if not root
                    if (!isRoot) {
                        const keySpan = document.createElement('span');
                        keySpan.className = 'json-key';
                        keySpan.textContent = typeof key === 'string' ? `"${key}": ` : `${key}: `;
                        nodeDiv.appendChild(keySpan);
                    }
                    
                    // Handle expandable objects and arrays
                    if (isExpandable) {
                        const isArray = Array.isArray(value);
                        const isEmpty = isArray ? value.length === 0 : Object.keys(value).length === 0;
                        
                        if (isEmpty) {
                            // Empty object/array
                            const emptySpan = document.createElement('span');
                            emptySpan.textContent = isArray ? '[]' : '{}';
                            nodeDiv.appendChild(emptySpan);
                            return nodeDiv;
                        }
                        
                        // Create collapsible element
                        const expanderSpan = document.createElement('span');
                        expanderSpan.className = 'collapsible';
                        
                        // Container for children
                        const childrenDiv = document.createElement('div');
                        
                        // Toggle expand/collapse
                        expanderSpan.addEventListener('click', () => {
                            expanderSpan.classList.toggle('collapsed');
                            childrenDiv.classList.toggle('hidden');
                        });
                        
                        // Add type/preview
                        const previewSpan = document.createElement('span');
                        previewSpan.className = 'text-gray-600 dark:text-gray-400';
                        
                        if (isArray) {
                            previewSpan.textContent = `Array(${value.length})`;
                            
                            // Add array entries
                            value.forEach((item, index) => {
                                const childNode = createNode(index, item);
                                childrenDiv.appendChild(childNode);
                            });
                        } else {
                            previewSpan.textContent = `Object(${Object.keys(value).length})`;
                            
                            // Add object properties
                            for (const [propKey, propValue] of Object.entries(value)) {
                                const childNode = createNode(propKey, propValue);
                                childrenDiv.appendChild(childNode);
                            }
                        }
                        
                        nodeDiv.appendChild(expanderSpan);
                        nodeDiv.appendChild(previewSpan);
                        nodeDiv.appendChild(childrenDiv);
                    }
                    // Handle base64 data with preview
                    else if ((key === 'base64Data' || key === 'dataUrl') && typeof value === 'string' && 
                            (value.startsWith('data:image') || key === 'base64Data' && isBinaryContent(value))) {
                        
                        // Get image URL
                        let dataUrl;
                        if (value.startsWith('data:')) {
                            dataUrl = value;
                        } else {
                            // Try to determine MIME type for base64Data
                            let mimeType = 'image/jpeg'; // Default
                            
                            // Try to find parent object with mimeType
                            let parentObj = getParentObject(data, key, value);
                            if (parentObj && parentObj.mimeType) {
                                mimeType = parentObj.mimeType;
                            }
                            
                            dataUrl = `data:${mimeType};base64,${value}`;
                        }
                        
                        // Create string representation (truncated)
                        const valueSpan = document.createElement('span');
                        valueSpan.className = 'json-string';
                        valueSpan.textContent = `"${truncateString(value, 40)}"`;
                        nodeDiv.appendChild(valueSpan);
                        
                        // Add image preview if it appears to be an image
                        if (dataUrl.startsWith('data:image')) {
                            const imgContainer = document.createElement('div');
                            imgContainer.className = 'mt-2 mb-1';
                            
                            const img = document.createElement('img');
                            img.className = 'base64-preview';
                            img.src = dataUrl;
                            img.alt = 'Image preview';
                            
                            imgContainer.appendChild(img);
                            nodeDiv.appendChild(imgContainer);
                        }
                    }
                    // Handle primitive values
                    else {
                        const valueSpan = document.createElement('span');
                        
                        if (value === null) {
                            valueSpan.className = 'json-null';
                            valueSpan.textContent = 'null';
                        } else if (typeof value === 'string') {
                            valueSpan.className = 'json-string';
                            valueSpan.textContent = `"${truncateString(value, 200)}"`;
                        } else if (typeof value === 'number') {
                            valueSpan.className = 'json-number';
                            valueSpan.textContent = value;
                        } else if (typeof value === 'boolean') {
                            valueSpan.className = 'json-boolean';
                            valueSpan.textContent = value;
                        } else {
                            valueSpan.textContent = value;
                        }
                        
                        nodeDiv.appendChild(valueSpan);
                    }
                    
                    return nodeDiv;
                }
                
                // Initialize the tree with root object
                container.appendChild(createNode('root', data, true));
            }
            
            // Create summary view of data
            function createDataSummary(data, container) {
                container.className = 'bg-white dark:bg-gray-800 p-4 rounded-lg';
                
                const summaryDiv = document.createElement('div');
                summaryDiv.className = 'space-y-6';
                
                // Source information
                const sourceDiv = document.createElement('div');
                sourceDiv.className = 'mb-6';
                
                if (data.url) {
                    sourceDiv.innerHTML = `
                        <h3 class="text-lg font-bold text-primary mb-2">Website Data</h3>
                        <p class="flex items-center">
                            <svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 015.656 0l4 4a4 4 0 01-5.656 5.656l-1.1-1.1"></path>
                            </svg>
                            <span class="font-medium">URL:</span> 
                            <a href="${data.url}" target="_blank" class="ml-1 text-primary hover:underline">${data.url}</a>
                        </p>
                        <p class="flex items-center mt-1">
                            <svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span class="font-medium">Extracted:</span> 
                            <span class="ml-1">${new Date(data.timestamp).toLocaleString()}</span>
                        </p>
                    `;
                } else if (data.filename) {
                    sourceDiv.innerHTML = `
                        <h3 class="text-lg font-bold text-primary mb-2">File Data</h3>
                        <p class="flex items-center">
                            <svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                            </svg>
                            <span class="font-medium">Filename:</span> 
                            <span class="ml-1">${data.filename}</span>
                        </p>
                        <p class="flex items-center mt-1">
                            <svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path>
                            </svg>
                            <span class="font-medium">Type:</span> 
                            <span class="ml-1">${data.fileType || 'Unknown'}</span>
                        </p>
                        <p class="flex items-center mt-1">
                            <svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"></path>
                            </svg>
                            <span class="font-medium">Size:</span> 
                            <span class="ml-1">${formatBytes(data.fileSize)}</span>
                        </p>
                    `;
                }
                
                summaryDiv.appendChild(sourceDiv);
                
                // Content statistics
                const statsDiv = document.createElement('div');
                statsDiv.className = 'mt-6';
                
                let statsHTML = '<h3 class="text-lg font-bold text-primary mb-4">Content Overview</h3>';
                statsHTML += '<div class="grid grid-cols-2 sm:grid-cols-4 gap-4">';
                
                // Add different stats based on data type
                if (data.url) {
                    // Website data
                    statsHTML += `
                        <div class="bg-white dark:bg-gray-700 rounded-lg p-4 text-center shadow-sm">
                            <div class="text-2xl font-bold text-primary">${data.text ? data.text.length : 0}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Text Elements</div>
                        </div>
                        <div class="bg-white dark:bg-gray-700 rounded-lg p-4 text-center shadow-sm">
                            <div class="text-2xl font-bold text-primary">${data.links ? data.links.length : 0}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Links</div>
                        </div>
                        <div class="bg-white dark:bg-gray-700 rounded-lg p-4 text-center shadow-sm">
                            <div class="text-2xl font-bold text-primary">${data.images ? data.images.length : 0}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Images</div>
                        </div>
                        <div class="bg-white dark:bg-gray-700 rounded-lg p-4 text-center shadow-sm">
                            <div class="text-2xl font-bold text-primary">${calculateJsonSize(data) > 0 ? formatBytes(calculateJsonSize(data)) : '0 B'}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Data Size</div>
                        </div>
                    `;
                } else if (data.textAnalysis) {
                    // Text file
                    statsHTML += `
                        <div class="bg-white dark:bg-gray-700 rounded-lg p-4 text-center shadow-sm">
                            <div class="text-2xl font-bold text-primary">${data.textAnalysis.wordCount || 0}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Words</div>
                        </div>
                        <div class="bg-white dark:bg-gray-700 rounded-lg p-4 text-center shadow-sm">
                            <div class="text-2xl font-bold text-primary">${data.textAnalysis.sentenceCount || 0}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Sentences</div>
                        </div>
                        <div class="bg-white dark:bg-gray-700 rounded-lg p-4 text-center shadow-sm">
                            <div class="text-2xl font-bold text-primary">${data.textAnalysis.paragraphCount || 0}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Paragraphs</div>
                        </div>
                        <div class="bg-white dark:bg-gray-700 rounded-lg p-4 text-center shadow-sm">
                            <div class="text-2xl font-bold text-primary">${formatBytes(data.fileSize || 0)}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">File Size</div>
                        </div>
                    `;
                } else if (data.isImage) {
                    // Image file
                    statsHTML += `
                        <div class="bg-white dark:bg-gray-700 rounded-lg p-4 text-center shadow-sm">
                            <div class="text-2xl font-bold text-primary">${data.metadata && data.metadata.dimensions ? data.metadata.dimensions.width : 'N/A'}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Width</div>
                        </div>
                        <div class="bg-white dark:bg-gray-700 rounded-lg p-4 text-center shadow-sm">
                            <div class="text-2xl font-bold text-primary">${data.metadata && data.metadata.dimensions ? data.metadata.dimensions.height : 'N/A'}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Height</div>
                        </div>
                        <div class="bg-white dark:bg-gray-700 rounded-lg p-4 text-center shadow-sm">
                            <div class="text-2xl font-bold text-primary">${data.fileType || 'Unknown'}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Format</div>
                        </div>
                        <div class="bg-white dark:bg-gray-700 rounded-lg p-4 text-center shadow-sm">
                            <div class="text-2xl font-bold text-primary">${formatBytes(data.fileSize || 0)}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Size</div>
                        </div>
                    `;
                } else {
                    // Generic file
                    statsHTML += `
                        <div class="bg-white dark:bg-gray-700 rounded-lg p-4 text-center shadow-sm col-span-2">
                            <div class="text-2xl font-bold text-primary">${data.fileType || 'Unknown Type'}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">File Format</div>
                        </div>
                        <div class="bg-white dark:bg-gray-700 rounded-lg p-4 text-center shadow-sm col-span-2">
                            <div class="text-2xl font-bold text-primary">${formatBytes(data.fileSize || 0)}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">File Size</div>
                        </div>
                    `;
                }
                
                statsHTML += '</div>';
                statsDiv.innerHTML = statsHTML;
                summaryDiv.appendChild(statsDiv);
                
                // Metadata summary if available
                if (data.metadata && Object.keys(data.metadata).length > 0) {
                    const metadataDiv = document.createElement('div');
                    metadataDiv.className = 'mt-6';
                    metadataDiv.innerHTML = '<h3 class="text-lg font-bold text-primary mb-2">Key Metadata</h3>';
                    
                    const metadataTable = document.createElement('div');
                    metadataTable.className = 'bg-white dark:bg-gray-700 rounded-lg overflow-hidden';
                    
                    // Get the most important metadata fields first
                    const priorityFields = ['title', 'description', 'author', 'keywords', 'language', 'publishedDate', 'canonical', 'viewport'];
                    
                    let tableRows = '';
                    
                    // Add priority fields first
                    priorityFields.forEach(field => {
                        if (data.metadata[field] && typeof data.metadata[field] !== 'object') {
                            tableRows += `
                                <div class="flex flex-col md:flex-row border-b border-gray-200 dark:border-gray-600 last:border-b-0">
                                    <div class="w-full md:w-1/3 p-3 bg-gray-50 dark:bg-gray-800 font-medium">${field}</div>
                                    <div class="w-full md:w-2/3 p-3">${data.metadata[field]}</div>
                                </div>
                            `;
                        }
                    });
                    
                    // Add other fields (up to 5 more)
                    let otherFieldCount = 0;
                    for (const [key, value] of Object.entries(data.metadata)) {
                        if (!priorityFields.includes(key) && value && typeof value !== 'object' && otherFieldCount < 5) {
                            tableRows += `
                                <div class="flex flex-col md:flex-row border-b border-gray-200 dark:border-gray-600 last:border-b-0">
                                    <div class="w-full md:w-1/3 p-3 bg-gray-50 dark:bg-gray-800 font-medium">${key}</div>
                                    <div class="w-full md:w-2/3 p-3">${value}</div>
                                </div>
                            `;
                            otherFieldCount++;
                        }
                    }
                    
                    metadataTable.innerHTML = tableRows;
                    metadataDiv.appendChild(metadataTable);
                    
                    // Add view all button if there are more fields
                    if (Object.keys(data.metadata).length > priorityFields.length + otherFieldCount) {
                        const viewAllButton = document.createElement('button');
                        viewAllButton.className = 'mt-2 text-sm text-primary hover:text-primaryLight flex items-center';
                        viewAllButton.innerHTML = `
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            View all ${Object.keys(data.metadata).length} metadata fields
                        `;
                        
                        viewAllButton.addEventListener('click', () => {
                            // Switch to tree view
                            viewMode.value = 'tree';
                            updateResultsView();
                        });
                        
                        metadataDiv.appendChild(viewAllButton);
                    }
                    
                    summaryDiv.appendChild(metadataDiv);
                }
                
                // Preview section based on content type
                if (data.url) {
                    // For websites - show image preview if available
                    if (data.images && data.images.length > 0) {
                        const previewDiv = document.createElement('div');
                        previewDiv.className = 'mt-6';
                        previewDiv.innerHTML = `
                            <h3 class="text-lg font-bold text-primary mb-2">Image Preview</h3>
                            <div class="grid grid-cols-3 gap-2">
                                ${data.images.slice(0, 3).map(img => `
                                    <div class="aspect-square bg-white dark:bg-gray-900 rounded overflow-hidden shadow-sm">
                                        <img src="${img.dataUrl || (img.base64Data ? `data:${img.mimeType || 'image/jpeg'};base64,${img.base64Data}` : img.url)}" 
                                             alt="${img.alt || 'Image preview'}" class="w-full h-full object-cover">
                                    </div>
                                `).join('')}
                            </div>
                            ${data.images.length > 3 ? `<p class="text-sm text-gray-600 dark:text-gray-400 mt-2">+ ${data.images.length - 3} more images</p>` : ''}
                        `;
                        summaryDiv.appendChild(previewDiv);
                    }
                } else if (data.isImage) {
                    // For image files - show the image
                    const imagePreviewDiv = document.createElement('div');
                    imagePreviewDiv.className = 'mt-6';
                    imagePreviewDiv.innerHTML = `
                        <h3 class="text-lg font-bold text-primary mb-2">Image Preview</h3>
                        <div class="bg-white dark:bg-gray-900 p-2 rounded-lg shadow-sm">
                            <img src="${data.dataUrl}" alt="${data.filename}" class="max-w-full h-auto max-h-[300px] mx-auto">
                        </div>
                    `;
                    summaryDiv.appendChild(imagePreviewDiv);
                } else if (data.textAnalysis) {
                    // For text files - show word frequency
                    if (data.textAnalysis.wordFrequency && Object.keys(data.textAnalysis.wordFrequency).length > 0) {
                        const wordCloudDiv = document.createElement('div');
                        wordCloudDiv.className = 'mt-6';
                        wordCloudDiv.innerHTML = `
                            <h3 class="text-lg font-bold text-primary mb-2">Top Words</h3>
                            <div class="bg-white dark:bg-gray-700 rounded-lg p-4 flex flex-wrap justify-center">
                                ${getTopWordsHTML(data.textAnalysis.wordFrequency, 15)}
                            </div>
                        `;
                        summaryDiv.appendChild(wordCloudDiv);
                    }
                }
                
                container.appendChild(summaryDiv);
            }
            
            // Update status display
            function updateStatus(status, message, items, size, updated) {
                const dot = statusIndicator.querySelector('.status-dot');
                const statusText = statusIndicator.querySelector('span:not(.status-dot)');
                
                // Update status dot
                dot.className = 'status-dot';
                if (status === 'active') {
                    dot.classList.add('active');
                } else if (status === 'processing') {
                    dot.classList.add('processing');
                } else if (status === 'error') {
                    dot.classList.add('error');
                }
                
                // Update status text
                statusText.textContent = message;
                
                // Update details
                document.getElementById('extracted-count').textContent = items;
                document.getElementById('data-size').textContent = size;
                document.getElementById('last-updated').textContent = updated;
            }
            
            // Analyze text content
            function analyzeText(text) {
                // Calculate word count
                const words = text.match(/\b\w+\b/g) || [];
                const wordCount = words.length;
                
                // Calculate sentence count
                const sentences = text.match(/[.!?]+(?=\s+[A-Z]|\s*$)/g) || [];
                const sentenceCount = sentences.length || text.split(/[.!?]+\s+/).length;
                
                // Calculate paragraph count
                const paragraphCount = text.split(/\n\s*\n/).filter(p => p.trim().length > 0).length || 1;
                
                // Calculate word frequency
                const wordFrequency = {};
                words.forEach(word => {
                    word = word.toLowerCase().replace(/[^\w']/g, '');
                    if (word.length > 3) { // Skip very short words
                        wordFrequency[word] = (wordFrequency[word] || 0) + 1;
                    }
                });
                
                // Sort by frequency and limit to top 30 words
                const sortedWords = {};
                Object.entries(wordFrequency)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 30)
                    .forEach(([word, count]) => {
                        sortedWords[word] = count;
                    });
                
                return {
                    wordCount,
                    sentenceCount,
                    paragraphCount,
                    charCount: text.length,
                    wordFrequency: sortedWords
                };
            }
            
            // Analyze sentiment of text content
            function analyzeSentiment(text) {
                // This is a simplified simulation of sentiment analysis
                // In a real app, you would use a proper NLP library
                
                // Simulate sentiment scoring
                const positiveWords = ['good', 'great', 'excellent', 'best', 'love', 'happy', 'positive', 'wonderful', 'amazing', 'fantastic'];
                const negativeWords = ['bad', 'awful', 'terrible', 'worst', 'hate', 'unhappy', 'negative', 'horrible', 'disappointing', 'poor'];
                
                // Tokenize text
                const words = text.toLowerCase().match(/\b\w+\b/g) || [];
                
                // Count sentiment indicators
                let positiveCount = 0;
                let negativeCount = 0;
                
                words.forEach(word => {
                    if (positiveWords.includes(word)) positiveCount++;
                    if (negativeWords.includes(word)) negativeCount++;
                });
                
                // Calculate sentiment score between -1 (negative) and 1 (positive)
                const total = positiveCount + negativeCount;
                let sentimentScore = 0;
                
                if (total > 0) {
                    sentimentScore = (positiveCount - negativeCount) / total;
                }
                
                // Calculate distributions
                const neutralWords = words.length - positiveCount - negativeCount;
                const total2 = words.length;
                
                const positive = positiveCount / total2;
                const negative = negativeCount / total2;
                const neutral = neutralWords / total2;
                
                // Simulate emotional tone detection
                const emotionalTone = {
                    joy: Math.min(1, Math.max(0, (positive * 0.7) + Math.random() * 0.3)),
                    sadness: Math.min(1, Math.max(0, (negative * 0.5) + Math.random() * 0.2)),
                    anger: Math.min(1, Math.max(0, (negative * 0.3) + Math.random() * 0.2)),
                    fear: Math.min(1, Math.max(0, (negative * 0.2) + Math.random() * 0.1)),
                    surprise: Math.min(1, Math.max(0, Math.random() * 0.5))
                };
                
                // Sort emotions by value (descending)
                const sortedEmotions = {};
                Object.entries(emotionalTone)
                    .sort((a, b) => b[1] - a[1])
                    .forEach(([emotion, value]) => {
                        sortedEmotions[emotion] = value;
                    });
                
                // Subjectivity score (0-1)
                // Higher value means more subjective/opinionated, lower means more objective/factual
                const subjectivity = 0.3 + Math.min(0.7, (positiveCount + negativeCount) / total2);
                
                return {
                    sentiment: {
                        score: sentimentScore,
                        positive,
                        negative,
                        neutral
                    },
                    emotionalTone: sortedEmotions,
                    subjectivity
                };
            }
            
            // Extract entities from text
            function extractEntities(text) {
                // This is a simplified simulation of entity extraction
                // In a real app, you would use a proper NLP library
                
                const entities = {
                    people: [],
                    organizations: [],
                    locations: [],
                    dates: [],
                    other: []
                };
                
                // Simplified named entity patterns
                // Look for capitalized words not at the beginning of sentences
                const potentialEntities = text.match(/(?<!\.\s+|\n|\?|\!)\b[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*\b/g) || [];
                
                // Count frequency of potential entities
                const entityFrequency = {};
                potentialEntities.forEach(entity => {
                    entityFrequency[entity] = (entityFrequency[entity] || 0) + 1;
                });
                
                // Sort by frequency
                const sortedEntities = Object.entries(entityFrequency)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 30)
                    .map(([entity]) => entity);
                
                // Simulate classification of entities
                // In a real application, this would use proper NER models
                sortedEntities.forEach(entity => {
                    // Classify based on simple heuristics
                    if (/\b(Mr|Mrs|Ms|Dr|Prof)\.\s+[A-Z][a-z]+/.test(entity) || 
                        /^[A-Z][a-z]+ (van |de |von |del |)?(Smith|Johnson|Williams|Jones|Brown|Miller|Wilson|Moore|Taylor|Anderson|Thomas|Harris|Martin|Thompson)$/.test(entity)) {
                        entities.people.push(entity);
                    } else if (/\b(Inc|Corp|Ltd|LLC|Company|Association|University|College|Institute|Group)\b/.test(entity)) {
                        entities.organizations.push(entity);
                    } else if (/\b(Street|Avenue|Boulevard|Road|Drive|Lane|Place|Square|Court|Park|Bridge|River|Lake|Mountain|Ocean|Sea|Gulf|Bay|Forest|Desert|Valley)\b/.test(entity) ||
                              /\b(North|South|East|West|Central|National|United States|U\.S\.|UK|China|India|Japan|Germany|France|Canada|Australia|Russia|Africa|Europe|Asia)\b/.test(entity)) {
                        entities.locations.push(entity);
                    } else if (/\b(January|February|March|April|May|June|July|August|September|October|November|December)\b/.test(entity) ||
                              /\b\d{1,2}(st|nd|rd|th)?\s+(January|February|March|April|May|June|July|August|September|October|November|December)(\s+\d{4})?\b/.test(entity) ||
                              /\b(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday)\b/.test(entity)) {
                        entities.dates.push(entity);
                    } else {
                        entities.other.push(entity);
                    }
                });
                
                // Limit each category to reasonable numbers
                entities.people = entities.people.slice(0, 10);
                entities.organizations = entities.organizations.slice(0, 8);
                entities.locations = entities.locations.slice(0, 8);
                entities.dates = entities.dates.slice(0, 6);
                entities.other = entities.other.slice(0, 8);
                
                return entities;
            }
            
            // Detect tech stack from extracted data
            function detectTechStack(data) {
                // This is a simplified simulation of tech stack detection
                // In a real app, this would use more sophisticated analysis
                
                const techStack = {
                    frontend: [],
                    backend: [],
                    framework: [],
                    analytics: [],
                    marketing: [],
                    server: [],
                    other: []
                };
                
                // Check for frontend technologies
                if (data.scripts) {
                    const scriptContent = data.scripts.map(s => s.content || '').join(' ');
                    const scriptSrcs = data.scripts.map(s => s.src || '').join(' ');
                    
                    // Frontend frameworks/libraries
                    if (scriptContent.includes('React') || scriptSrcs.includes('react')) {
                        techStack.frontend.push({ name: 'React', version: '18.x' });
                    }
                    
                    if (scriptContent.includes('Vue') || scriptSrcs.includes('vue')) {
                        techStack.frontend.push({ name: 'Vue.js', version: '3.x' });
                    }
                    
                    if (scriptContent.includes('angular') || scriptSrcs.includes('angular')) {
                        techStack.frontend.push({ name: 'Angular', version: '15.x' });
                    }
                    
                    if (scriptContent.includes('jQuery') || scriptSrcs.includes('jquery')) {
                        techStack.frontend.push({ name: 'jQuery', version: '3.6.0' });
                    }
                }
                
                // Check for CSS frameworks
                if (data.styles) {
                    const styleContent = data.styles.map(s => s.content || '').join(' ');
                    const styleHrefs = data.styles.map(s => s.href || '').join(' ');
                    
                    if (styleContent.includes('tailwind') || styleHrefs.includes('tailwind')) {
                        techStack.frontend.push({ name: 'Tailwind CSS', version: '3.x' });
                    }
                    
                    if (styleContent.includes('bootstrap') || styleHrefs.includes('bootstrap')) {
                        techStack.frontend.push({ name: 'Bootstrap', version: '5.x' });
                    }
                }
                
                // Check for analytics
                const htmlContent = JSON.stringify(data);
                
                if (htmlContent.includes('gtag') || htmlContent.includes('google-analytics')) {
                    techStack.analytics.push({ name: 'Google Analytics', version: '4' });
                }
                
                if (htmlContent.includes('facebook-pixel') || htmlContent.includes('fbq(')) {
                    techStack.marketing.push({ name: 'Facebook Pixel', version: 'Latest' });
                }
                
                // Check for server technology from headers or meta information
                if (data.metadata && data.metadata.generator) {
                    if (data.metadata.generator.includes('WordPress')) {
                        techStack.backend.push({ name: 'WordPress', version: '6.x' });
                    } else if (data.metadata.generator.includes('Drupal')) {
                        techStack.backend.push({ name: 'Drupal', version: '9.x' });
                    } else if (data.metadata.generator.includes('Joomla')) {
                        techStack.backend.push({ name: 'Joomla', version: '4.x' });
                    } else {
                        techStack.backend.push({ name: data.metadata.generator, version: 'Unknown' });
                    }
                }
                
                // Additional technologies based on content patterns
                if (htmlContent.includes('shopify') || htmlContent.includes('myshopify')) {
                    techStack.framework.push({ name: 'Shopify', version: 'Latest' });
                }
                
                if (htmlContent.includes('wix')) {
                    techStack.framework.push({ name: 'Wix', version: 'Latest' });
                }
                
                // Add some simulated data for demo purposes
                techStack.frontend.push({ name: 'HTML5', version: 'Latest' });
                techStack.frontend.push({ name: 'CSS3', version: 'Latest' });
                techStack.backend.push({ name: 'Node.js', version: '16.x' });
                techStack.server.push({ name: 'Nginx', version: '1.20' });
                techStack.analytics.push({ name: 'Hotjar', version: 'Latest' });
                
                return techStack;
            }
            
            // Calculate readability score
            function calculateReadabilityScore(text) {
                // Simplified readability score between 0-100
                // Higher score means easier to read
                
                // Get basic text stats
                const words = text.match(/\b\w+\b/g) || [];
                const sentences = text.match(/[.!?]+(?=\s+[A-Z]|\s*$)/g) || [];
                
                if (words.length === 0 || sentences.length === 0) {
                    return 50; // Default middle score
                }
                
                // Calculate averages
                const avgWordsPerSentence = words.length / sentences.length;
                
                // Count long words (more than 6 letters)
                const longWords = words.filter(word => word.length > 6).length;
                const longWordPercentage = longWords / words.length;
                
                // Calculate score (simplified algorithm)
                // Lower words per sentence and fewer long words = higher readability
                const score = 100 - ((avgWordsPerSentence * 4) + (longWordPercentage * 100));
                
                // Ensure score is between 0-100
                return Math.min(100, Math.max(0, Math.round(score)));
            }
            
            // Create comprehensive website data (simulation for demo)
            function createComprehensiveWebsiteData(url, domain) {
                const timestamp = new Date().toISOString();
                
                // Extract domain parts for more realistic simulation
                const domainParts = domain.split('.');
                const domainName = domainParts[0];
                
                // Create metadata based on domain
                const metadata = {
                    title: `${domainName.charAt(0).toUpperCase() + domainName.slice(1)} - ${generateDomainTitle(domainName)}`,
                    description: `${generateDomainDescription(domainName)}`,
                    keywords: generateKeywords(domainName),
                    author: generateAuthor(domainName),
                    language: 'en',
                    publishedDate: new Date(Date.now() - Math.floor(Math.random() * 7776000000)).toISOString(), // Random date in last 90 days
                    favicon: `https://${domain}/favicon.ico`,
                    generator: generateGenerator(domainName),
                    viewport: 'width=device-width, initial-scale=1',
                    robots: 'index, follow',
                    canonicalUrl: url,
                    og: {
                        title: `${domainName.charAt(0).toUpperCase() + domainName.slice(1)} - ${generateDomainTitle(domainName)}`,
                        description: generateDomainDescription(domainName),
                        image: `https://${domain}/og-image.jpg`,
                        type: 'website',
                        site_name: domainName.charAt(0).toUpperCase() + domainName.slice(1)
                    },
                    twitter: {
                        card: 'summary_large_image',
                        site: '@' + domainName,
                        creator: '@' + generateTwitterHandle(domainName),
                        title: `${domainName.charAt(0).toUpperCase() + domainName.slice(1)} - ${generateDomainTitle(domainName)}`,
                        description: generateDomainDescription(domainName)
                    }
                };
                
                // Generate comprehensive data
                const data = {
                    source: 'url',
                    url: url,
                    timestamp: timestamp,
                    metadata: metadata,
                    text: generateTextElements(domainName, 50 + Math.floor(Math.random() * 50)),
                    links: generateLinks(domain, 20 + Math.floor(Math.random() * 30)),
                    images: generateImages(domain, 8 + Math.floor(Math.random() * 8)),
                    styles: generateStyles(3 + Math.floor(Math.random() * 3)),
                    scripts: generateScripts(5 + Math.floor(Math.random() * 5)),
                    forms: generateForms(1 + Math.floor(Math.random() * 2)),
                    domTree: generateDomTree(domain)
                };
                
                return data;
            }
            
            // Helper function - Generate domain-specific title
            function generateDomainTitle(domain) {
                const titles = {
                    'example': 'Sample Website for Demonstration',
                    'test': 'Testing Portal | Quality Assurance Suite',
                    'demo': 'Interactive Demo and Showcase',
                    'shop': 'Online Store | Best Products & Deals',
                    'blog': 'Expert Articles & Latest News',
                    'news': 'Breaking News & Latest Updates',
                    'tech': 'Technology Solutions & Services',
                    'design': 'Creative Design Portfolio & Services',
                    'photo': 'Photography Portfolio & Gallery',
                    'travel': 'Travel Guides & Adventure Inspiration',
                    'food': 'Recipes & Culinary Inspiration',
                    'health': 'Health & Wellness Resources',
                    'fitness': 'Fitness Programs & Workout Guides',
                    'learn': 'Educational Platform & Courses',
                    'business': 'Business Solutions & Services',
                    'marketing': 'Marketing Strategies & Services',
                    'social': 'Social Network & Community Platform',
                    'forum': 'Discussion Community & Knowledge Base',
                    'music': 'Music Library & Streaming Service',
                    'video': 'Video Platform & Content Library'
                };
                
                // Find matching domain or use default
                for (const [key, title] of Object.entries(titles)) {
                    if (domain.includes(key)) {
                        return title;
                    }
                }
                
                // Default title
                return 'Official Website | Home Page';
            }
            
            // Helper function - Generate domain-specific description
            function generateDomainDescription(domain) {
                const descriptions = {
                    'example': 'A comprehensive demonstration website showcasing various features and functionalities for web development examples.',
                    'test': 'Testing environment for quality assurance and development validation with comprehensive testing tools and resources.',
                    'demo': 'Interactive demonstration platform featuring product tours, feature showcases, and hands-on examples.',
                    'shop': 'Discover our curated selection of premium products at competitive prices with secure shopping and fast delivery.',
                    'blog': 'Thought-provoking articles, expert insights, and the latest news covering a wide range of topics from industry specialists.',
                    'news': 'Stay informed with breaking news, in-depth analysis, and current events coverage from around the world.',
                    'tech': 'Innovative technology solutions and services designed to optimize performance and enhance digital experiences.',
                    'design': 'Creative design solutions showcasing our portfolio of stunning visuals, user interfaces, and brand identities.',
                    'photo': 'Captivating photography portfolio featuring breathtaking images across various styles and subjects.',
                    'travel': 'Inspiring travel guides, destination reviews, and adventure planning resources for travelers of all types.',
                    'food': 'Delicious recipes, cooking tips, and culinary inspiration for food enthusiasts and home chefs.',
                    'health': 'Evidence-based health information, wellness resources, and expert advice for a balanced lifestyle.',
                    'fitness': 'Effective fitness programs, workout guides, and training resources to help you achieve your physical goals.',
                    'learn': 'Educational platform offering courses, tutorials, and learning resources across diverse subjects and skill levels.',
                    'business': 'Professional business solutions, consulting services, and strategic resources for organizational growth.',
                    'marketing': 'Effective marketing strategies, campaign management, and promotional services to enhance brand visibility.',
                    'social': 'Vibrant social networking platform for connecting with friends, sharing experiences, and building communities.',
                    'forum': 'Active discussion community and knowledge base where experts and enthusiasts exchange ideas and solutions.',
                    'music': 'Comprehensive music library and streaming service featuring diverse genres and artist collections.',
                    'video': 'Engaging video platform with extensive content library covering entertainment, education, and beyond.'
                };
                
                // Find matching domain or use default
                for (const [key, description] of Object.entries(descriptions)) {
                    if (domain.includes(key)) {
                        return description;
                    }
                }
                
                // Default description
                return 'Welcome to our official website. Discover our products, services, and latest updates. Contact us to learn more about what we offer.';
            }
            
            // Helper function - Generate keywords based on domain
            function generateKeywords(domain) {
                const baseKeywords = ['website', 'official', 'online', 'services', 'information'];
                
                const domainKeywords = {
                    'example': ['sample', 'demo', 'test', 'demonstration', 'showcase'],
                    'test': ['testing', 'quality assurance', 'QA', 'validation', 'verification'],
                    'demo': ['demonstration', 'interactive', 'showcase', 'preview', 'sample'],
                    'shop': ['store', 'products', 'shopping', 'buy', 'ecommerce'],
                    'blog': ['articles', 'posts', 'news', 'insights', 'content'],
                    'news': ['breaking news', 'current events', 'headlines', 'updates', 'stories'],
                    'tech': ['technology', 'innovation', 'digital', 'solutions', 'IT'],
                    'design': ['creative', 'portfolio', 'graphics', 'UI/UX', 'visuals'],
                    'photo': ['photography', 'images', 'gallery', 'portfolio', 'pictures'],
                    'travel': ['destinations', 'trips', 'vacations', 'adventures', 'guides'],
                    'food': ['recipes', 'cooking', 'cuisine', 'ingredients', 'meals'],
                    'health': ['wellness', 'medical', 'healthcare', 'lifestyle', 'nutrition'],
                    'fitness': ['workout', 'exercise', 'training', 'gym', 'health'],
                    'learn': ['education', 'courses', 'tutorials', 'learning', 'skills'],
                    'business': ['corporate', 'services', 'solutions', 'professional', 'enterprise'],
                    'marketing': ['advertising', 'promotion', 'branding', 'digital marketing', 'strategy'],
                    'social': ['network', 'community', 'connect', 'friends', 'sharing'],
                    'forum': ['discussion', 'community', 'questions', 'answers', 'topics'],
                    'music': ['songs', 'artists', 'streaming', 'playlists', 'albums'],
                    'video': ['videos', 'streaming', 'content', 'watch', 'channels']
                };
                
                // Find matching domain keywords or use default
                let keywords = [...baseKeywords];
                
                for (const [key, wordList] of Object.entries(domainKeywords)) {
                    if (domain.includes(key)) {
                        keywords = [...keywords, ...wordList];
                        break;
                    }
                }
                
                // If no match, add domain name itself
                if (keywords.length === baseKeywords.length) {
                    keywords.push(domain);
                }
                
                return keywords;
            }
            
            // Helper function - Generate author name
            function generateAuthor(domain) {
                const firstNames = ['John', 'Sarah', 'Michael', 'Emily', 'David', 'Jessica', 'Robert', 'Jennifer', 'William', 'Elizabeth'];
                const lastNames = ['Smith', 'Johnson', 'Williams', 'Jones', 'Brown', 'Miller', 'Davis', 'Garcia', 'Rodriguez', 'Wilson'];
                
                // Use deterministic selection based on domain
                const domainHash = domain.split('').reduce((sum, char) => sum + char.charCodeAt(0), 0);
                const firstName = firstNames[domainHash % firstNames.length];
                const lastName = lastNames[(domainHash + 3) % lastNames.length];
                
                return `${firstName} ${lastName}`;
            }
            
            // Helper function - Generate Twitter handle
            function generateTwitterHandle(domain) {
                // Short version of domain plus random number
                return domain.slice(0, 6) + Math.floor(Math.random() * 1000);
            }
            
            // Helper function - Generate CMS/generator
            function generateGenerator(domain) {
                const generators = ['WordPress 6.2', 'Drupal 9.4', 'Joomla 4.2', 'Shopify', 'Wix', 'Squarespace', 'Ghost 5.0', 'Next.js', 'Gatsby', 'Nuxt.js'];
                
                // Deterministic selection based on domain
                const domainHash = domain.split('').reduce((sum, char) => sum + char.charCodeAt(0), 0);
                return generators[domainHash % generators.length];
            }
            
            // Helper function - Generate text elements
            function generateTextElements(domain, count) {
                const tags = ['h1', 'h2', 'h3', 'p', 'p', 'p', 'p', 'li', 'blockquote', 'div'];
                const textElements = [];
                
                // Generate domain-specific words
                const domainWords = generateDomainWords(domain);
                
                for (let i = 0; i < count; i++) {
                    const tag = tags[i % tags.length === 0 ? Math.floor(Math.random() * tags.length) : i % tags.length];
                    let content = '';
                    
                    // Generate appropriate content based on tag
                    if (tag === 'h1') {
                        content = generateHeadingText(domain, 4, 8);
                    } else if (tag === 'h2' || tag === 'h3') {
                        content = generateHeadingText(domain, 3, 10);
                    } else if (tag === 'p') {
                        content = generateParagraphText(domainWords, 15, 30);
                    } else if (tag === 'li') {
                        content = generateSentence(domainWords, 5, 15);
                    } else if (tag === 'blockquote') {
                        content = generateSentence(domainWords, 10, 20);
                    } else {
                        content = generateSentence(domainWords, 5, 15);
                    }
                    
                    // Add text element with attributes
                    textElements.push({
                        tag: tag,
                        content: content,
                        position: i,
                        visible: Math.random() > 0.05, // 5% chance of hidden text
                        attributes: {
                            class: generateTagClasses(tag),
                            id: Math.random() > 0.8 ? `text-${i}` : undefined
                        }
                    });
                }
                
                return textElements;
            }
            
            // Helper function - Generate links
            function generateLinks(domain, count) {
                const links = [];
                
                // Internal links (70%)
                const internalCount = Math.floor(count * 0.7);
                for (let i = 0; i < internalCount; i++) {
                    const path = generateRandomPath();
                    links.push({
                        url: `https://${domain}/${path}`,
                        text: generateLinkText(path),
                        isExternal: false,
                        attributes: {
                            class: generateLinkClasses(false),
                            rel: Math.random() > 0.9 ? 'nofollow' : undefined,
                            title: Math.random() > 0.7 ? generateLinkTitle(path) : undefined,
                            target: Math.random() > 0.8 ? '_blank' : undefined
                        }
                    });
                }
                
                // External links (30%)
                const externalDomains = ['example.com', 'test.org', 'sample.net', 'reference.io', 'external-site.com', 'othersite.org'];
                for (let i = 0; i < count - internalCount; i++) {
                    const externalDomain = externalDomains[i % externalDomains.length];
                    const path = generateRandomPath();
                    links.push({
                        url: `https://${externalDomain}/${path}`,
                        text: generateLinkText(path, externalDomain),
                        isExternal: true,
                        attributes: {
                            class: generateLinkClasses(true),
                            rel: 'nofollow' + (Math.random() > 0.5 ? ' noreferrer' : ''),
                            title: Math.random() > 0.6 ? generateLinkTitle(path, externalDomain) : undefined,
                            target: '_blank'
                        }
                    });
                }
                
                return links;
            }
            
            // Helper function - Generate images with base64 data
            function generateImages(domain, count) {
                const images = [];
                const altTexts = generateImageAltTexts(domain, count);
                
                for (let i = 0; i < count; i++) {
                    const width = 200 + Math.floor(Math.random() * 800);
                    const height = 150 + Math.floor(Math.random() * 500);
                    const aspectRatio = width / height;
                    
                    // Generate placeholder image data URL
                    // In a real application, these would be actual images from the site
                    const placeholderColor = getPlaceholderColor(domain, i);
                    const textColor = getContrastColor(placeholderColor);
                    
                    // Create SVG placeholder image
                    const svgImage = `<svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}" viewBox="0 0 ${width} ${height}">
                        <rect width="${width}" height="${height}" fill="${placeholderColor}"/>
                        <text x="50%" y="50%" font-family="Arial, sans-serif" font-size="24" text-anchor="middle" dy=".3em" fill="${textColor}">${width} × ${height}</text>
                        ${Math.random() > 0.5 ? `<text x="50%" y="calc(50% + 30px)" font-family="Arial, sans-serif" font-size="18" text-anchor="middle" fill="${textColor}">${domain}</text>` : ''}
                    </svg>`;
                    
                    // Convert SVG to base64
                    const dataUrl = 'data:image/svg+xml;base64,' + btoa(svgImage);
                    
                    images.push({
                        url: `https://${domain}/images/image-${i + 1}.jpg`,
                        alt: altTexts[i],
                        width: width,
                        height: height,
                        aspectRatio: aspectRatio.toFixed(2),
                        mimeType: 'image/jpeg',
                        fileSize: width * height * (1 + Math.random()),  // simulate file size
                        dataUrl: dataUrl,
                        base64Data: dataUrl.split(',')[1],
                        attributes: {
                            class: generateImageClasses(),
                            loading: Math.random() > 0.7 ? 'lazy' : undefined,
                            id: Math.random() > 0.8 ? `img-${i + 1}` : undefined,
                            srcset: Math.random() > 0.6 ? generateSrcset(domain, i + 1) : undefined
                        }
                    });
                }
                
                return images;
            }
            
            // Helper function - Generate styles
            function generateStyles(count) {
                const styles = [];
                
                for (let i = 0; i < count; i++) {
                    styles.push({
                        type: Math.random() > 0.4 ? 'external' : 'inline',
                        href: Math.random() > 0.4 ? generateStylesheetUrl(i) : undefined,
                        content: Math.random() > 0.4 ? undefined : generateCSSContent(),
                        media: Math.random() > 0.7 ? generateMediaQuery() : undefined,
                        attributes: {
                            id: Math.random() > 0.6 ? `style-${i + 1}` : undefined,
                            rel: 'stylesheet'
                        }
                    });
                }
                
                return styles;
            }
            
            // Helper function - Generate scripts
            function generateScripts(count) {
                const scripts = [];
                
                for (let i = 0; i < count; i++) {
                    scripts.push({
                        type: Math.random() > 0.6 ? 'external' : 'inline',
                        src: Math.random() > 0.6 ? generateScriptUrl(i) : undefined,
                        content: Math.random() > 0.6 ? undefined : generateJSContent(),
                        attributes: {
                            async: Math.random() > 0.6,
                            defer: Math.random() > 0.7,
                            id: Math.random() > 0.6 ? `script-${i + 1}` : undefined
                        }
                    });
                }
                
                return scripts;
            }
            
            // Helper function - Generate forms
            function generateForms(count) {
                const forms = [];
                const formTypes = ['contact', 'search', 'newsletter', 'login', 'registration'];
                
                for (let i = 0; i < count; i++) {
                    const formType = formTypes[i % formTypes.length];
                    const fields = generateFormFields(formType);
                    
                    forms.push({
                        id: `form-${formType}`,
                        action: formType === 'search' ? '/search' : formType === 'login' ? '/login' : '/submit',
                        method: formType === 'search' ? 'GET' : 'POST',
                        enctype: formType === 'contact' && Math.random() > 0.5 ? 'multipart/form-data' : 'application/x-www-form-urlencoded',
                        fields: fields,
                        buttons: generateFormButtons(formType),
                        attributes: {
                            class: `form form-${formType} ${Math.random() > 0.5 ? 'form-inline' : 'form-stacked'}`,
                            novalidate: Math.random() > 0.7
                        }
                    });
                }
                
                return forms;
            }
            
            // Helper function - Generate DOM tree
            function generateDomTree(domain) {
                // Simplified tree structure - in a real app this would be more comprehensive
                return {
                    tag: 'html',
                    attributes: { lang: 'en' },
                    children: [
                        {
                            tag: 'head',
                            children: [
                                { tag: 'title', textContent: generateDomainTitle(domain) },
                                { tag: 'meta', attributes: { charset: 'UTF-8' } },
                                { tag: 'meta', attributes: { name: 'viewport', content: 'width=device-width, initial-scale=1.0' } },
                                { tag: 'meta', attributes: { name: 'description', content: generateDomainDescription(domain) } },
                                { tag: 'link', attributes: { rel: 'stylesheet', href: '/styles.css' } },
                                { tag: 'script', attributes: { src: '/script.js', defer: true } }
                            ]
                        },
                        {
                            tag: 'body',
                            children: [
                                {
                                    tag: 'header',
                                    attributes: { class: 'site-header' },
                                    children: [
                                        {
                                            tag: 'nav',
                                            attributes: { class: 'main-nav' },
                                            children: [
                                                { tag: 'a', attributes: { href: '/' }, textContent: 'Home' },
                                                { tag: 'a', attributes: { href: '/about' }, textContent: 'About' },
                                                { tag: 'a', attributes: { href: '/services' }, textContent: 'Services' },
                                                { tag: 'a', attributes: { href: '/contact' }, textContent: 'Contact' }
                                            ]
                                        },
                                        { tag: 'h1', textContent: domain.charAt(0).toUpperCase() + domain.slice(1) }
                                    ]
                                },
                                {
                                    tag: 'main',
                                    attributes: { class: 'content', id: 'main-content' },
                                    children: [
                                        {
                                            tag: 'section',
                                            attributes: { class: 'hero', id: 'hero' },
                                            children: [
                                                { tag: 'h2', textContent: generateHeadingText(domain, 4, 8) },
                                                { tag: 'p', textContent: generateSentence(generateDomainWords(domain), 15, 25) },
                                                { tag: 'a', attributes: { href: '/get-started', class: 'btn btn-primary' }, textContent: 'Get Started' }
                                            ]
                                        },
                                        {
                                            tag: 'section',
                                            attributes: { class: 'features' },
                                            children: [
                                                { tag: 'h2', textContent: 'Our Features' },
                                                {
                                                    tag: 'div',
                                                    attributes: { class: 'feature-grid' },
                                                    children: [
                                                        {
                                                            tag: 'div',
                                                            attributes: { class: 'feature-card' },
                                                            children: [
                                                                { tag: 'h3', textContent: 'Feature 1' },
                                                                { tag: 'p', textContent: generateSentence(generateDomainWords(domain), 10, 20) }
                                                            ]
                                                        },
                                                        {
                                                            tag: 'div',
                                                            attributes: { class: 'feature-card' },
                                                            children: [
                                                                { tag: 'h3', textContent: 'Feature 2' },
                                                                { tag: 'p', textContent: generateSentence(generateDomainWords(domain), 10, 20) }
                                                            ]
                                                        },
                                                        {
                                                            tag: 'div',
                                                            attributes: { class: 'feature-card' },
                                                            children: [
                                                                { tag: 'h3', textContent: 'Feature 3' },
                                                                { tag: 'p', textContent: generateSentence(generateDomainWords(domain), 10, 20) }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    tag: 'footer',
                                    attributes: { class: 'site-footer' },
                                    children: [
                                        { tag: 'p', textContent: `© ${new Date().getFullYear()} ${domain}. All rights reserved.` },
                                        {
                                            tag: 'div',
                                            attributes: { class: 'footer-links' },
                                            children: [
                                                { tag: 'a', attributes: { href: '/privacy' }, textContent: 'Privacy Policy' },
                                                { tag: 'a', attributes: { href: '/terms' }, textContent: 'Terms of Service' },
                                                { tag: 'a', attributes: { href: '/sitemap' }, textContent: 'Sitemap' }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                };
            }
            
            // Helper function - Generate data statistics
            function generateDataStats(data) {
                const stats = {
                    text: data.text ? data.text.length : 0,
                    images: data.images ? data.images.length : 0,
                    links: data.links ? data.links.length : 0,
                    internalLinks: data.links ? data.links.filter(link => !link.isExternal).length : 0,
                    externalLinks: data.links ? data.links.filter(link => link.isExternal).length : 0,
                    styles: data.styles ? data.styles.length : 0,
                    scripts: data.scripts ? data.scripts.length : 0,
                    forms: data.forms ? data.forms.length : 0,
                    metadata: data.metadata || {},
                    domElements: 0
                };
                
                // Count DOM elements if available
                function countDomElements(node) {
                    if (!node) return 0;
                    
                    let count = 1; // Count this node
                    
                    if (node.children) {
                        node.children.forEach(child => {
                            count += countDomElements(child);
                        });
                    }
                    
                    return count;
                }
                
                if (data.domTree) {
                    stats.domElements = countDomElements(data.domTree);
                }
                
                return stats;
            }
            
            // Format helpers
            
            // Helper function - Format bytes to human-readable size
            function formatBytes(bytes, decimals = 2) {
                if (bytes === 0) return '0 B';
                
                const k = 1024;
                const dm = decimals < 0 ? 0 : decimals;
                const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
                
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                
                return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;
            }
            
            // Helper function - Truncate string with ellipsis
            function truncateString(str, maxLength) {
                if (!str) return '';
                return str.length <= maxLength ? str : str.substr(0, maxLength) + '...';
            }
            
            // Helper function - Calculate JSON size
            function calculateJsonSize(data) {
                return new TextEncoder().encode(JSON.stringify(data)).length;
            }
            
            // Helper function - Count total items in data
            function countTotalItems(data) {
                let count = 0;
                
                // Add primary elements
                count += (data.text || []).length;
                count += (data.links || []).length;
                count += (data.images || []).length;
                count += (data.styles || []).length;
                count += (data.scripts || []).length;
                count += (data.forms || []).length;
                
                // Add metadata fields
                if (data.metadata) {
                    count += Object.keys(data.metadata).length;
                }
                
                return count;
            }
            
            // Helper function - Check if likely binary content
            function isBinaryContent(content) {
                // Simplified check - in a real app would be more sophisticated
                return content && content.length > 100 && !/^[\x00-\x7F]*$/.test(content.substring(0, 100));
            }
            
            // Helper function - Get parent object containing specified value
            function getParentObject(obj, key, value) {
                // This is a simplified implementation
                // In a real app would need a more robust traversal algorithm
                if (!obj || typeof obj !== 'object') return null;
                
                for (const [k, v] of Object.entries(obj)) {
                    if (k === key && v === value) return obj;
                    
                    if (typeof v === 'object' && v !== null) {
                        const result = getParentObject(v, key, value);
                        if (result) return result;
                    }
                }
                
                return null;
            }
            
            // Helper function - Get top words formatted as HTML
            function getTopWordsHTML(wordFrequency, limit = 10) {
                if (!wordFrequency || Object.keys(wordFrequency).length === 0) {
                    return '<span class="text-gray-500 dark:text-gray-400">No word frequency data available</span>';
                }
                
                const topWords = Object.entries(wordFrequency)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, limit);
                
                // Find min and max for scaling
                const minCount = topWords[topWords.length - 1][1];
                const maxCount = topWords[0][1];
                const range = maxCount - minCount;
                
                return topWords.map(([word, count]) => {
                    // Scale size between 0.8rem and 1.5rem
                    const size = range > 0 
                        ? 0.8 + ((count - minCount) / range) * 0.7 
                        : 1;
                        
                    return `<span class="inline-block px-2 py-1 m-1 bg-primary bg-opacity-10 rounded text-primary dark:bg-opacity-20" 
                                 style="font-size: ${size}rem">${word} <small class="text-xs text-gray-500 dark:text-gray-400">${count}</small></span>`;
                }).join('');
            }
            
            // Helper function - Get top words formatted as text
            function getTopWordsFormatted(wordFrequency, limit = 5) {
                if (!wordFrequency || Object.keys(wordFrequency).length === 0) {
                    return 'No word frequency data available';
                }
                
                return Object.entries(wordFrequency)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, limit)
                    .map(([word, count]) => `${word} (${count})`)
                    .join(', ');
            }
            
            // Helper function - Format visualization type name
            function formatVizTypeName(type) {
                const names = {
                    'dom-tree': 'DOM Structure',
                    'content-breakdown': 'Content Breakdown',
                    'link-graph': 'Link Relationships',
                    'word-cloud': 'Word Cloud',
                    'image-gallery': 'Image Gallery'
                };
                
                return names[type] || type.charAt(0).toUpperCase() + type.slice(1);
            }
            
            // Helper function - Format analysis type name
            function formatAnalysisTypeName(type) {
                const names = {
                    'content-analysis': 'Content Analysis',
                    'seo-analysis': 'SEO Analysis',
                    'sentiment-analysis': 'Sentiment Analysis',
                    'entity-extraction': 'Entity Extraction',
                    'tech-stack': 'Tech Stack Detection'
                };
                
                return names[type] || type.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
            }
            
            // Helper function - Get readability color class
            function getReadabilityColorClass(score) {
                if (score >= 80) return 'bg-green-500';
                if (score >= 60) return 'bg-green-300';
                if (score >= 40) return 'bg-yellow-400';
                if (score >= 20) return 'bg-orange-400';
                return 'bg-red-500';
            }
            
            // Helper function - Get readability description
            function getReadabilityDescription(score) {
                if (score >= 80) return 'Very easy to read. Suitable for elementary school students.';
                if (score >= 60) return 'Easy to read. Conversational English for most readers.';
                if (score >= 40) return 'Moderately difficult to read. Best understood by high school graduates.';
                if (score >= 20) return 'Difficult to read. Academic level. Best understood by college graduates.';
                return 'Very difficult to read. Scientific or technical material. Requires advanced education.';
            }
            
            // Helper function - Get SEO score class
            function getSEOScoreClass(score) {
                if (score >= 80) return 'border-green-500 text-green-500';
                if (score >= 60) return 'border-green-300 text-green-400';
                if (score >= 40) return 'border-yellow-400 text-yellow-500';
                if (score >= 20) return 'border-orange-400 text-orange-500';
                return 'border-red-500 text-red-500';
            }
            
            // Helper function - Get SEO score label
            function getSEOScoreLabel(score) {
                if (score >= 80) return 'Excellent';
                if (score >= 60) return 'Good';
                if (score >= 40) return 'Fair';
                if (score >= 20) return 'Poor';
                return 'Critical';
            }
            
            // Helper function - Get sentiment label
            function getSentimentLabel(score) {
                if (score >= 0.6) return 'Very Positive';
                if (score >= 0.2) return 'Positive';
                if (score > -0.2) return 'Neutral';
                if (score > -0.6) return 'Negative';
                return 'Very Negative';
            }
            
            // Helper function - Get sentiment color
            function getSentimentColor(score) {
                if (score >= 0.6) return 'bg-green-500';
                if (score >= 0.2) return 'bg-green-300';
                if (score > -0.2) return 'bg-gray-400';
                if (score > -0.6) return 'bg-red-300';
                return 'bg-red-500';
            }
            
            // Helper function - Get subjectivity description
            function getSubjectivityDescription(score) {
                if (score >= 0.8) return 'Highly subjective. Contains many personal opinions and judgments.';
                if (score >= 0.6) return 'Subjective. Includes opinions and personal viewpoints.';
                if (score >= 0.4) return 'Somewhat subjective. Balances facts with some opinions.';
                if (score >= 0.2) return 'Somewhat objective. Mostly factual with limited personal views.';
                return 'Highly objective. Presents facts with minimal personal judgment.';
            }
            
            // Helper function - Get emotion color
            function getEmotionColor(emotion) {
                const colors = {
                    'joy': 'bg-yellow-400',
                    'sadness': 'bg-blue-400',
                    'anger': 'bg-red-500',
                    'fear': 'bg-purple-400',
                    'surprise': 'bg-green-400',
                    'disgust': 'bg-orange-500',
                    'trust': 'bg-green-500',
                    'anticipation': 'bg-indigo-400'
                };
                
                return colors[emotion] || 'bg-gray-400';
            }
            
            // Helper function - Get category display name
            function getCategoryDisplayName(category) {
                const names = {
                    'frontend': 'Frontend Technologies',
                    'backend': 'Backend Technologies',
                    'framework': 'Frameworks & CMS',
                    'analytics': 'Analytics & Tracking',
                    'marketing': 'Marketing Technologies',
                    'server': 'Server Technologies',
                    'other': 'Other Technologies'
                };
                
                return names[category] || category.charAt(0).toUpperCase() + category.slice(1);
            }
            
            // Helper function - Get tech icon
            function getTechIcon(techName) {
                // This would ideally use proper SVG icons for each technology
                // For simplicity, we're using the first letter of each tech
                return techName.charAt(0).toUpperCase();
            }
            
            // Helper function - Check if string is URL
            function isURL(string) {
                try {
                    new URL(string.startsWith('http') ? string : 'https://' + string);
                    return true;
                } catch (e) {
                    return false;
                }
            }
            
            // Helper function - Extract domain from URL
            function extractDomain(url) {
                try {
                    const match = url.match(/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n?]+)/im);
                    return match && match[1] ? match[1] : 'example.com';
                } catch (e) {
                    return 'example.com';
                }
            }
            
            // Content generation helpers
            
            // Helper function - Generate domain-specific words
            // Content generation helpers
            function generateDomainWords(domain) {
                const commonWords = ['the', 'and', 'to', 'of', 'in', 'for', 'our', 'we', 'with', 'you', 'your', 'on', 'is', 'are', 'this', 'that'];
                
                // Add domain-specific words based on domain type
                const domainWords = {
                    'example': ['sample', 'test', 'demo', 'example', 'showcase'],
                    'test': ['testing', 'validation', 'verify', 'check', 'analyze'],
                    'demo': ['demonstration', 'preview', 'trial', 'sample', 'showcase'],
                    'blog': ['article', 'post', 'content', 'author', 'read'],
                    'shop': ['product', 'price', 'buy', 'cart', 'store'],
                    'news': ['article', 'latest', 'breaking', 'report', 'update'],
                    'tech': ['technology', 'software', 'digital', 'innovation', 'solution']
                };
                
                // Find matching domain words or use defaults
                let words = [...commonWords];
                for (const [key, wordList] of Object.entries(domainWords)) {
                    if (domain.includes(key)) {
                        words = [...words, ...wordList];
                        break;
                    }
                }
                
                return words;
            }

            function generateHeadingText(domain, minWords, maxWords) {
                const words = generateDomainWords(domain);
                const length = minWords + Math.floor(Math.random() * (maxWords - minWords + 1));
                return generateSentence(words, length, length);
            }

            function generateParagraphText(words, minWords, maxWords) {
                const sentences = 1 + Math.floor(Math.random() * 3);
                return Array(sentences).fill(0)
                    .map(() => generateSentence(words, minWords, maxWords))
                    .join(' ');
            }

            function generateSentence(words, minWords, maxWords) {
                const length = minWords + Math.floor(Math.random() * (maxWords - minWords + 1));
                const sentence = Array(length).fill(0)
                    .map(() => words[Math.floor(Math.random() * words.length)])
                    .join(' ');
                return sentence.charAt(0).toUpperCase() + sentence.slice(1) + '.';
            }
